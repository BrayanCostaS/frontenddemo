(function(g){var window=this;'use strict';var kib=function(a){const b=new g.SN("und",new g.wM("Default","und",!0));b.captionTracks=a.captionTracks;return b},lib=function(a){return new g.Eg(function(b,c){var d=a.length,e=[];
if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},h=function(m){c(m)},k=0,l;k<a.length;k++)l=a[k],g.Mg(l,g.Ma(f,k),h);
else b(e)})},J5=function(a){return g.Bw((0,g.U7a)(),a)},mib=function({type:a,
payload:b}){a={type:a};void 0!==b&&(a.payload=b);return a},K5=function(a){a=a.key||a.id;
if(!a)throw Error("Entity key is missing");return a},nib=function(){if(L5)return L5();
L5=g.Kw("PersistentEntityStoreDb",{fq:{EntityStore:{mm:1},EntityAssociationStore:{mm:2}},shared:!1,upgrade(a,b){b(1)&&g.ww(g.rw(a,"EntityStore",{keyPath:"key"}),"entityType","entityType");b(2)&&(a=g.rw(a,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.ww(a,"byParentEntityKey","parentEntityKey"),g.ww(a,"byChildEntityKey","childEntityKey"))},version:3});return L5()},oib=function(a){return g.Bw(nib(),a)},pib=function(a){return a instanceof Error?new M5("UNKNOWN_ENCODE_ERROR",
{WK:a.message}):new M5("UNKNOWN_ENCODE_ERROR")},qib=function(a){return a instanceof Error?new M5("UNKNOWN_DECODE_ERROR",{WK:a.message}):new M5("UNKNOWN_DECODE_ERROR")},rib=function(a,b){a=a instanceof M5?a:b(a);
g.hz(a);throw a;},sib=function(a,b,c){try{return a.B(b,c)}catch(d){rib(d,pib)}},N5=function(a){a=(new TextEncoder).encode(a).subarray(0,16);
const b=new Uint8Array(16);b.set(a);return b},uib=function(a){const b=tib[a];
if(b)return b;g.iz(new g.Ov("Entity model not found.",{entityType:a}))},P5=function(a,b){a:{a=O5(a.A,b.version);
try{var c=a.A(b.data,b.key);break a}catch(d){rib(d,qib)}c=void 0}return c},Q5=function(a,b,c){return a.j.objectStore("EntityStore").get(b).then(d=>{if(d){if(c&&d.entityType!==c)throw Error("Incorrect entity type");
return P5(a,d)}})},R5=function(a,b,c){return c?(c=c.map(d=>Q5(a,d,b)),g.kw.all(c)):a.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(b)).then(d=>d.map(e=>P5(a,e)))},wib=function(a,b,c){const d=K5(b);
return S5(a,d).then(()=>vib(a,b,c))},T5=function(a,b,c){let d=a.B[c];
d||(d=new Set,a.B[c]=d);d.add(b)},U5=function(a,b,c){const d=K5(b),e=O5(a.A,1),f=Object.assign({},b);
return a.j.objectStore("EntityStore").get(d).then(h=>{if(h){if(h.entityType!==c)throw Error("Incorrect entity type");f.entityMetadata||(h=P5(a,h),f.entityMetadata=h.entityMetadata)}}).then(()=>{const h={key:d,
entityType:c,data:sib(e,f,d),version:1};return g.kw.all([g.uw(a.j.objectStore("EntityStore"),h),wib(a,f,c)])}).then(()=>{T5(a,d,c);
return d})},V5=function(a,b,c){b=b.map(d=>U5(a,d,c));
return g.kw.all(b)},yib=function(a,b,c){if(c.has(b))return g.kw.resolve(void 0);
c.add(b);return xib(a,b).then(d=>a.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b)).then(()=>d)).then(d=>{let e=g.kw.resolve(void 0);
for(const f of d)e=e.then(()=>yib(a,f,c));
return e}).then(()=>{})},W5=function(a,b,c){if(null==c?0:c.At){const e=new Set;
return yib(a,b,e).then(()=>{const f=[];for(const h of e)f.push(W5(a,h));return g.kw.all(f).then(()=>{})})}const d=g.dI(b).entityType;
return g.kw.all([a.j.objectStore("EntityStore").delete(b),S5(a,b)]).then(()=>{T5(a,b,d)})},S5=function(a,b){return a.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b))},zib=function(a,b){return g.zw(a.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(b)},c=>g.kw.all([c.delete(),
S5(a,c.ZD())]).then(()=>{T5(a,c.ZD(),b);return c.continue()}))},Aib=function(a,b,c,d){const e=O5(a.A,1);
return Q5(a,b,d).then(f=>{if(f){f=g.uH(f,c);var h={key:b,entityType:d,data:sib(e,f,b),version:1};return g.kw.all([g.uw(a.j.objectStore("EntityStore"),h),wib(a,f,d)])}}).then(()=>{T5(a,b,d);
return b})},vib=function(a,b,c){const d=K5(b);
c=uib(c);if(!c)return g.kw.resolve([]);b=new c(b);a=a.j.objectStore("EntityAssociationStore");c=[];for(const e of b.A())c.push(g.uw(a,{parentEntityKey:d,childEntityKey:e}));return g.kw.all(c).then(e=>e.map(f=>f[1]))},xib=function(a,b){const c=a.j.objectStore("EntityAssociationStore");
return c.index("byParentEntityKey").getAll(IDBKeyRange.only(b)).then(d=>{const e=[];for(const f of d)e.push(c.index("byChildEntityKey").getAll(f.childEntityKey));return g.kw.all(e)}).then(d=>{const e=[];
for(const f of d)1===f.length&&e.push(f[0].childEntityKey);return e})},O5=function(a,b=0){a=a.j[b];
if(!a)throw b=new M5("INVALID_ENCODER_VERSION",{ZO:b}),g.hz(b),b;return a},Bib=function(a,b){for(const c of a.observers)c(b)},X5=async function(a,b,c){let d;
b=await g.qw(await oib(a.token),["EntityStore","EntityAssociationStore"],b,e=>{d=new Cib(e,a.j);return c(d)});
if(d){const e=d.B;0<Object.keys(e).length&&(a.channel.postMessage(e),Bib(a,e))}return b},Y5=function(a,b){a.observers.push(b);
return()=>{const c=a.observers.indexOf(b);0<=c&&a.observers.splice(c,1)}},Z5=function(a,b,c){return X5(a,{mode:"readwrite",
jc:!0},d=>U5(d,b,c))},Dib=function(a,b){return X5(a,{mode:"readwrite",
jc:!0},c=>V5(c,b,"offlineOrchestrationActionWrapperEntity"))},Eib=function(a,b){return X5(a,{mode:"readwrite",
jc:!0},c=>W5(c,b))},$5=function(a,b,c){return X5(a,{mode:"readonly",
jc:!0},d=>Q5(d,b,c))},a6=function(a,b,c){return X5(a,{mode:"readonly",
jc:!0},d=>R5(d,b,c))},Hib=async function(){try{const b=await g.Jw();
if(b&&g.Nv()&&"undefined"!==typeof g.la.BroadcastChannel){var a=new Fib;return new Gib(b,a)}}catch(b){b instanceof Error&&g.hz(b)}},c6=function(){b6||(b6=Hib());
return b6},Iib=function(a){let b;
a=null==(b=a.options)?void 0:b.persistenceOption;return"ENTITY_PERSISTENCE_OPTION_PERSIST"===a||"ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"===a},Jib=async function(a){const b=await c6();
b&&await X5(b,"readwrite",c=>{const d={};for(const e of a){if(!e.entityKey||!Iib(e))continue;const f=g.Od(e.payload);let h=void 0;"ENTITY_MUTATION_TYPE_REPLACE"===e.type&&(h=()=>U5(c,e.payload[f],f));
"ENTITY_MUTATION_TYPE_DELETE"===e.type&&(h=()=>W5(c,e.entityKey));
"ENTITY_MUTATION_TYPE_UPDATE"===e.type&&(h=()=>Aib(c,e.entityKey,e.payload[f],f));
h&&(d[e.entityKey]=d[e.entityKey]?d[e.entityKey].then(h):h())}return g.kw.all(Object.values(d))})},Kib=async function(a){!(a=a.mutations)||0>=a.length||(g.JO&&g.JO.dispatch(mib({type:"ENTITY_LOADED",
payload:a})),await Jib(a),a.length=0)},Lib=function(a){return void 0!==a},Mib=function(a){var b=g.eO();
b=Object.assign({},b);a=Object.assign({},a);for(const c in b)a[c]?(4!==b[c]&&(b[c]=a[c]),delete a[c]):2!==b[c]&&(b[c]=4);Object.assign(b,a);g.RFa(b);JSON.stringify(b);return b},Nib=async function(a){const b=await g.Jw();
if(b)return g.qw(await g.hO(b),["index","media","captions"],{mode:"readwrite",jc:!0},c=>{const d=IDBKeyRange.bound(a+"|",a+"~");c=[c.objectStore("index").delete(d),c.objectStore("media").delete(d),c.objectStore("captions").delete(d)];return g.kw.all(c).then(()=>{})})},Oib=async function(){const a=await g.Jw();
if(!a)throw g.jw("rvdfd");return g.qw(await g.hO(a),["index","media"],{mode:"readwrite",jc:!0},b=>{const c={};return g.yw(b.objectStore("index"),{},d=>{var e=d.getKey().match(/^([\w\-_]+)\|(a|v)$/);let f=g.kw.resolve(void 0);if(e){const h=e[1];e=e[2];c[h]=c[h]||{};let k;c[h][e]=g.VFa(null==(k=d.getValue())?void 0:k.fmts)}else f=d.delete().then(()=>{});
return g.kw.all([d.continue(),f]).then(([h])=>h)}).then(()=>{const d={};
for(const f of Object.keys(c)){const h=c[f].v;d[f]=c[f].a&&h?1:2}const e=Mib(d);return g.Bha(b.objectStore("media"),{},f=>{const h=f.getKey().match(g.$Fa);h&&d[h[1]]||b.objectStore("media").delete(f.getKey());return f.continue()}).then(()=>e)})})},Pib=async function(a,b){const c=await g.Jw();
if(!c)throw g.jw("wct");await g.qw(await g.hO(c),["captions"],{mode:"readwrite",jc:!0},d=>{const e=[];d=d.objectStore("captions");for(let f=0;f<b.length;f++){const h=g.uw(d,b[f],a+"|"+b[f].metadata.vss_id);e.push(h)}return g.kw.all(e)})},Qib=async function(a){a=IDBKeyRange.bound(a+"|",a+"~");
const b=await g.Jw();if(!b)throw g.jw("gactfv");return(await g.hO(b)).getAll("captions",a)},Rib=async function(a){g.gO(a,0);
return Nib(a)},Sib=function(a){return{context:g.UA(),
videoIds:a}},Tib=function(a){return{context:g.UA(),
playlistIds:a}},Uib=function(a){return{context:g.UA(),
offlinePlaylistSyncChecks:a}},Vib=function(a,b,c,d,e,f){a={entityKey:a};
c&&(a.refreshData=c);d&&(a.isExpiredStreamUrlRefetch=d);e&&(a.downloadParameters=e);f&&(a.offlineSourceData=f);return{context:g.lP(b),signatureTimestamp:19605,videos:[a]}},Xib=function(){d6||(d6=new Wib);
return d6},Yib=function(a,b){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:a},metadata:b,statusCode:void 0,csn:void 0,can:void 0}},Zib=function(a,b,c){c||(c=a.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION"),c||(c=g.Px(16),a.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",c)));
a={flowNonce:c,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:b.eventType};b.metadata&&(a.flowMetadata=b.metadata);void 0!==b.statusCode&&(a.flowEventStatus=b.statusCode);b.csn&&(a.csn=b.csn);b.can&&(a.can=b.can);g.Yv("flowEvent",a,void 0)},$ib=async function(a){const b=await X5(a,{mode:"readonly",
jc:!0},l=>R5(l,"playbackData").then(m=>{var n=m.map(q=>q.transfer).filter(q=>!!q),p=m.map(q=>q.offlineVideoPolicy).filter(q=>!!q);
n=R5(l,"transfer",n);p=R5(l,"offlineVideoPolicy",p);return g.kw.all([n,p]).then(([q,t])=>[m,q,t])}));
a=await X5(a,{mode:"readonly",jc:!0},l=>R5(l,"mainDownloadsListEntity").then(m=>{let n,p;return null!=(p=null==(n=m[0])?void 0:n.downloads)?p:[]}));
const [c,d,e]=b,f={},h={},k={};for(const l of d)l&&(f[l.key]=l);for(const l of e)l&&(h[l.key]=l);for(const l of a){let m;k[null!=(m=l.videoItem)?m:""]=!0}return{offlineVideos:c.map(l=>{var m=f[l.transfer],n=h[l.offlineVideoPolicy],p=g.dI(n.key).entityId;l=g.eI(p,"mainVideoEntity");{let q;if("OFFLINE_VIDEO_POLICY_ACTION_DISABLE"===n.action)q="OFFLINE_VIDEO_STATE_DISABLED",n.expirationTimestamp&&Number(n.expirationTimestamp)<Date.now()/1E3&&(q="OFFLINE_VIDEO_STATE_EXPIRED"),n=q;else if("OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED"===
n.action)n="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(null==m?void 0:m.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":q="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":q="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":q="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":q="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":q="OFFLINE_VIDEO_STATE_PLAYABLE";break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":q=
"OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:q="OFFLINE_VIDEO_STATE_UNKNOWN"}if("OFFLINE_VIDEO_STATE_OFFLINE_FAILED"===q)switch(null==m?void 0:m.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":q="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":q="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":q=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}n=q}}p={id:p,videoState:n};if(null==m?0:m.cotn)p.cotn=m.cotn;if(null==m?0:m.maximumDownloadQuality)p.selectedVideoQuality=null==m?void 0:m.maximumDownloadQuality;if(null==m?0:m.lastProgressTimeMs)p.lastProgressTimeMs=m.lastProgressTimeMs;p.selectedOfflineMode=k[l]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";return p})}},bjb=function(){try{let c=g.pa("ytglobal.locks_");
if(c)return c;var a;if(a=navigator){var b=navigator;a="locks"in b&&!!b.locks}if(a)return g.la.localStorage&&g.la.localStorage.getItem("noop"),c=new ajb,g.ma("ytglobal.locks_",c),c}catch(c){}},e6=function(a){if(a.includes(":"))throw Error(`Invalid user cache name: ${a}`);
return`${a}:${g.Mv("CacheStorage get")}`},cjb=async function(){return void 0!==f6?f6:f6=new Promise(async a=>{try{await g6.open("test-only"),await g6.delete("test-only")}catch(b){if(b instanceof Error&&"SecurityError"===b.name){a(!1);
return}}a("caches"in window)})},i6=async function(){if(await cjb())return h6||(h6=new djb),h6},j6=function(a,b,c){g.iz(new g.Ov(`Woffle: ${a}`,c?{cotn:c}:""));
b instanceof Error&&g.iz(b)},ejb=async function(a){a=await $ib(a);
g.Yv("offlineStateSnapshot",a)},k6=function(a,b){a.api.Ua("onOfflineOperationFailure",b);
let c;null==(c=a.j)||c.postMessage(b)},fjb=function(a){if(!a.B&&!a.j){var b=bjb();
if(b){a.B=!0;var c=g.Mv("OfflineLockManager");b.request(`${"woffle_orchestration_leader"}:${c}`,{},async()=>{try{a.A=new g.YZ,a.j=!0,a.B=!1,await a.O(),await a.A.promise}catch(d){let e;(null==(e=a.N)?0:e.call(a,"wo_relinquish_leadership_on_lock_request_error"))||a.NF();d instanceof Error&&(d.args=[{name:"WoLockManagerError",nF:d.name}],g.hz(d))}})}}},l6=function(a){a.K&&a.J&&a.D&&a.visibility.isBackground()?g.bs(a.C,6E4):a.C.stop()},gjb=function(a){a.j&&(a.D=!0,l6(a))},hjb=function(a,b){a.j&&(a.J=
b,l6(a))},ijb=function(a,b){a.j&&(a.K=b,l6(a))},m6=function(a,{videoId:b,
ll:c,offlineModeType:d}){a.encryptedVideoId=b;a.cotn=null==c?void 0:c.cotn;a.offlineabilityFormatType=null==c?void 0:c.maximumDownloadQuality;let e;a.isRefresh=null!=(e=null==c?void 0:c.isRefresh)?e:!1;let f;a.softErrorCount=null!=(f=null==c?void 0:c.transferRetryCount)?f:0;a.offlineModeType=null!=d?d:"OFFLINE_NOW";g.Yv("offlineTransferStatusChanged",a)},jjb=function(a,b,c,d){d={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!d};b&&c&&(b=Math.floor(b/1024).toFixed(),c=Math.floor(c/1024).toFixed(),d.alreadyDownloadedKbytes=b,d.totalFetchedKbytes=b,d.totalContentKbytes=c);m6(d,a)},kjb=function(a){m6({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},a)},ljb=function(a){switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
n6=function(a){let b,c,d;
return 0<(null!=(d=null==(b=a.actionMetadata)?void 0:null==(c=b.retryScheduleIntervalsInSeconds)?void 0:c.length)?d:0)},o6=function(a){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===a.actionType&&!!a.entityKey},p6=function(a){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"===a.actionType&&!!a.entityKey},q6=function(a){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===a.actionType&&!!a.entityKey},r6=async function(a,b,c,d,e=!1){const f=g.eI(a,b),h=g.eI(a,"downloadStatusEntity");
a=await X5(c,{mode:"readonly",jc:!0},l=>g.kw.all([Q5(l,f,b),Q5(l,h,"downloadStatusEntity")]));
const k=a.length?a[0]:void 0;if(k){let l=1<a.length?a[1]:void 0;if(l){if("DOWNLOAD_STATE_USER_DELETED"===l.downloadState&&!e)return;l.downloadState=d}else l={key:h,downloadState:d};g.tz(k,mjb,l);await X5(c,{mode:"readwrite",jc:!0},m=>g.kw.all([U5(m,k,b),U5(m,l,"downloadStatusEntity")]))}},s6=function(a,b){return a.actionType===b.actionType&&a.entityKey===b.entityKey},t6=function(a,b){if(a&&"TRANSFER_STATE_COMPLETE"!==a.transferState&&"TRANSFER_STATE_FAILED"!==a.transferState){const c=g.dI(a.key).entityId;
m6({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:c,ll:a,offlineModeType:b})}},u6=function(a){if(!a||!a.thumbnails)return[];
const b=[];for(const c of a.thumbnails)c.url&&b.push(c.url);return b},njb=function(a,b,c){return new g.tQ(a,{cotn:b,
raw_player_response:c,download_media:!0,start:Infinity,disable_watch_next:!0})},ojb=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},w6=function(a){if(!a.key)throw Error("Entity key is required.");
if(!a.actionProto)throw Error("OfflineOrchestrationAction is required.");const b=g.dI(a.key),c=g.dI(a.actionProto.entityKey);return new v6(c.entityType,b.entityId,a.actionProto,a.parentActionId,a.rootActionId,a.childActionIds,a.prereqActionId,a.postreqActionIds,a.retryScheduleIndex,a.hasChildActionFailed,1E3*Number(a.enqueueTimeSec))},x6=function(a){return{key:g.eI(a.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:a.action,parentActionId:a.parentActionId,rootActionId:a.rootActionId,childActionIds:a.childActionIds,prereqActionId:a.prereqActionId,postreqActionIds:a.postreqActionIds,retryScheduleIndex:a.retryScheduleIndex,hasChildActionFailed:a.hasChildActionFailed,enqueueTimeSec:(a.j/1E3).toFixed()}},pjb=async function(){const a=await i6();
return a?a.delete("yt-player-local-img"):!0},y6=async function(a){const b=await i6();
if(!b)throw Error("Cache API not supported");if(a.length){var c=await b.open("yt-player-local-img");await Promise.all(a.map(d=>c.delete(d)))}},z6=async function(a){const b=await i6();
if(!b)throw Error("Cache API not supported");a.length&&await (await b.open("yt-player-local-img")).addAll(a)},A6=async function(a,b,c,d,e){const f=g.eI(a,"mainVideoEntity"),h=g.eI(a,"ytMainChannelEntity"),k=g.eI(a,"transfer"),l=g.eI(a,"videoDownloadContextEntity");
var m=await X5(b,{mode:"readonly",jc:!0},Q=>g.kw.all([Q5(Q,f,"mainVideoEntity"),Q5(Q,h,"ytMainChannelEntity"),Q5(Q,k,"transfer"),e?Q5(Q,l,"videoDownloadContextEntity"):void 0,R5(Q,"ytMainChannelEntity"),R5(Q,"offlineOrchestrationActionWrapperEntity")]));
const [n,p,q,t,v,A]=m;if(n||p){m=n?u6(n.thumbnail):[];var E=p?await qjb(p,v):[];await y6(m.concat(E))}const H=[],K=g.eI(a,"mainVideoEntity"),U=g.eI(a,"downloadStatusEntity");for(const Q of A)m=g.dI(Q.key).entityId,E=w6(Q),E=g.dI(E.action.entityKey).entityId,m!==a&&E!==a||s6(c,Q.actionProto)||H.push(Q.key);await X5(b,{mode:"readwrite",jc:!0},Q=>{const fa=H.map(xa=>W5(Q,xa));
fa.push(W5(Q,K,{At:!0}));fa.push(W5(Q,U,{At:!0}));return g.kw.all(fa)});
t6(q,null==t?void 0:t.offlineModeType);k6(d,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},B6=async function(a,b,c,d,e){const f=g.eI(a,"mainPlaylistEntity"),h=g.eI(a,"ytMainChannelEntity");
var k=await X5(b,{mode:"readonly",jc:!0},H=>g.kw.all([Q5(H,f,"mainPlaylistEntity"),Q5(H,h,"ytMainChannelEntity"),R5(H,"mainPlaylistEntity"),R5(H,"mainDownloadsListEntity"),R5(H,"ytMainChannelEntity"),R5(H,"offlineOrchestrationActionWrapperEntity")]));
const [l,m,n,p,q,t]=k;if(l||m){k=l?rjb(l):[];var v=m?await qjb(m,q):[];await y6(k.concat(v))}const A=[];for(const H of t)k=g.dI(H.key).entityId,v=w6(H),k!==a&&v.rootActionId!==a||s6(c,H.actionProto)||A.push(H.key);const E=g.eI(a,"mainPlaylistEntity");await X5(b,{mode:"readwrite",jc:!0},H=>{const K=A.map(U=>W5(H,U));
K.push(W5(H,E,{At:!0}));return g.kw.all(K)});
if(l&&(a=await sjb(l,n,p),a.reverse(),a))for(const H of a)await A6(H,b,c,d,e)},C6=async function(a,b,c,d){const e=g.eI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),f=new Map;
a=await X5(a,{mode:"readwrite",jc:!0},h=>{const k=R5(h,"transfer"),l=R5(h,"offlineOrchestrationActionWrapperEntity");let m=void 0;d&&(m=R5(h,"videoDownloadContextEntity"));const n=Q5(h,e,"mainDownloadsListEntity");return g.kw.all([k,l,m,n]).then(([p,q,t,v])=>{const A=tjb.map(E=>zib(h,E));
for(const E of q){q="mainVideoEntity"===g.dI(E.actionProto.entityKey).entityType;const H="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===E.actionProto.actionType;s6(b,E.actionProto)||q&&(!q||H)||A.push(W5(h,E.key,{At:!0}))}v&&(v.downloads=[],A.push(U5(h,v,"mainDownloadsListEntity")));if(t)for(const E of t)t=g.dI(E.key).entityId,t=g.eI(t,"transfer"),f.set(t,E.offlineModeType);return g.kw.all(A).then(()=>p)})});
for(const h of a)t6(h,f.get(h.key)),a=g.dI(h.key).entityId,a=g.eI(a,"mainVideoEntity"),k6(c,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});await pjb()},rjb=function(a,b){let c=[];
if(a.thumbnailStyleData)for(const d of a.thumbnailStyleData){let e,f,h;c=c.concat(u6(null==(e=d)?void 0:null==(f=e.value)?void 0:null==(h=f.collageThumbnail)?void 0:h.coverThumbnail))}a=u6(b);return c.concat(a)},sjb=async function(a,b,c){const d=[],e=new Set;
if(c.length)for(var f of c){let h;if(null==(h=f.downloads)?0:h.length)for(const k of f.downloads)k.videoItem&&(c=g.dI(k.videoItem).entityId,e.add(c))}if(a.videos){for(const h of a.videos)f=JSON.parse(g.dI(h).entityId),f.videoId&&!e.has(f.videoId)&&d.push(f.videoId);for(const h of b)if(h.key!==a.key&&(b=h.videos))for(const k of b)b=JSON.parse(g.dI(k).entityId),b.videoId&&(b=d.indexOf(b.videoId),-1!==b&&d.splice(b,1))}return d},qjb=async function(a,b){const c=u6(a.avatar);
for(const d of b)if(d.id!==a.id)for(const e of u6(d.avatar))b=c.indexOf(e),-1!==b&&c.splice(b,1);return c},ujb=async function(a){const b=g.P(a.frameworkUpdates,D6);
a.frameworkUpdates&&b&&await Kib(b)},xjb=function(a){let b;
if(null!=(b=a.onResponseReceivedActions)&&b.length){var c;a=null==(c=g.P(g.P(a.onResponseReceivedActions[0],vjb),wjb))?void 0:c.actions;if(null!=a&&a.length)return a}},yjb=async function(a){if(!a)return[];
a=await $5(a,E6,"mainDownloadsListEntity");let b;return(null==a?0:null==(b=a.downloads)?0:b.length)?a.downloads.map(c=>{let d;return null!=(d=c.videoItem)?d:""}):[]},F6=async function(a,b){const c=await zjb(a,b);
c&&await X5(a,{mode:"readwrite",jc:!0},d=>{const e=[U5(d,c.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];c.mainDownloadsListEntity&&e.push(U5(d,c.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.kw.all(e)})},zjb=async function(a,b){const c=g.eI("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.eI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
a=await X5(a,{mode:"readonly",jc:!0},l=>g.kw.all([Q5(l,c,"mainDownloadsLibraryEntity"),Q5(l,d,"mainDownloadsListEntity")]));
let [e,f]=a;a=e;let h=f;a||(a={id:c});for(const l of b)if(l===E6){if(a.smartDownloadsList)return;a.smartDownloadsList=l}else{var k=g.dI(l).entityType;b={};"mainPlaylistEntity"===k?b.playlistItem=l:"mainVideoEntity"===k&&(b.videoItem=l);if(!g.Zd(b)){let m;if(null==(m=h)?0:m.downloads){k=!1;for(const n of h.downloads)if(n.playlistItem===l||n.videoItem===l){k=!0;break}k||h.downloads.push(b)}else h={id:d,downloads:[b]};a.downloadsList=d}}return{mainDownloadsLibraryEntity:a,mainDownloadsListEntity:h}},
G6=async function(a,b){const c=g.eI("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.eI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
var e=await X5(a,{mode:"readonly",jc:!0},l=>g.kw.all([Q5(l,c,"mainDownloadsLibraryEntity"),Q5(l,d,"mainDownloadsListEntity"),Q5(l,E6,"mainDownloadsListEntity")]));
const [f,h,k]=e;if(f){if(b===E6&&(null==k?0:k.downloads))k.downloads=[];else if(null==h?0:h.downloads){e=g.dI(b).entityType;for(let l=0;l<h.downloads.length;l++){const m=h.downloads[l];if("mainVideoEntity"===e&&m.videoItem===b){h.downloads.splice(l,1);break}else if("mainPlaylistEntity"===e&&m.playlistItem===b){h.downloads.splice(l,1);break}}}await X5(a,{mode:"readwrite",jc:!0},l=>{const m=[U5(l,f,"mainDownloadsLibraryEntity")];h&&m.push(U5(l,h,"mainDownloadsListEntity"));k&&m.push(U5(l,k,"mainDownloadsListEntity"));
return g.kw.all(m)})}},Ajb=async function(a,b){const c=new Map;
for(const d of b)c.set(d,await a.A(d));return c},H6=function(a,b,c,d,e,f){b=g.eI(b,c);
d=Object.assign({},f,{priority:d,retryScheduleIntervalsInSeconds:e});return{actionType:a,entityKey:b,actionMetadata:d}},Ejb=async function(a,b){var c=b.entityKey,d,e=null==(d=g.P(b.actionMetadata,I6))?void 0:d.isEnqueuedForExpiredStreamUrlRefetch;
try{d=void 0;a.Y.N("html5_enable_oduc")&&(d=await Bjb(a,b));{const k=g.P(b.actionMetadata,I6);var f=k?{maximumDownloadQuality:k.maximumDownloadQuality}:void 0}const h=await Cjb(a,c,{isEnqueuedForExpiredStreamUrlRefetch:e,YS:f,offlineSourceData:d});if(!h)return J6(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",n6(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR");await Djb(a,h,b);return J6(b,
!0,h.orchestrationActions)}catch(h){return c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.fw&&"QUOTA_EXCEEDED"===h.type&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),j6("PDE handleAdd error"),f=g.dI(b.entityKey).entityId,await r6(f,"mainVideoDownloadStateEntity",a.j,n6(b)?"DOWNLOAD_STATE_RETRYABLE_FAILURE":"DOWNLOAD_STATE_FAILED"),J6(b,!1,void 0,c,e)}},
Fjb=async function(a,b){const c=b.entityKey;
var d=await X5(a.j,{mode:"readonly",jc:!0},m=>{const n=Q5(m,c,"playbackData"),p=Q5(m,g.eI(g.dI(b.entityKey).entityId,"offlineVideoPolicy"),"offlineVideoPolicy");m=Q5(m,g.eI(g.dI(b.entityKey).entityId,"transfer"),"transfer");return g.kw.all([n,p,m])});
const [e,f,h]=d;if(!e||!f)return J6(b,!0);d={lastPlayerResponseTimestampSeconds:e.playerResponseTimestamp,offlineToken:f.offlineToken};const k={};if(null==h?0:h.maximumDownloadQuality)k.maximumDownloadQuality=h.maximumDownloadQuality;try{let m=void 0;a.Y.N("html5_enable_oduc")&&(m=await Bjb(a,b));var l=await Cjb(a,c,{refreshData:d,YS:k,offlineSourceData:m});if(!l)return J6(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",n6(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR");await Djb(a,l,b);return J6(b,!0,l.orchestrationActions)}catch(m){return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.fw&&"QUOTA_EXCEEDED"===m.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J6(b,!1,void 0,a,l)}},Bjb=async function(a,b){b=g.dI(b.entityKey).entityId;
b=g.eI(b,"videoDownloadContextEntity");a=await $5(a.j,b,"videoDownloadContextEntity");if(null!=a&&a.offlineModeType)return{offlineModeType:a.offlineModeType}},Cjb=async function(a,b,c){const d=g.RB();
a=Vib(b,a.Y,c.refreshData,c.isEnqueuedForExpiredStreamUrlRefetch,c.YS,c.offlineSourceData);b=g.WA(Gjb);return g.PB(d,a,b).then(e=>e)},J6=function(a,b,c,d,e){const f=n6(a);
for(const h of c||[])if(h.actionMetadata){let k;h.actionMetadata.priority=(null==(k=a.actionMetadata)?void 0:k.priority)||1}return new K6(b?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,c,d,e)},Djb=async function(a,b,c){if(b.frameworkUpdates&&g.P(b.frameworkUpdates,D6)){if(g.P(b.frameworkUpdates,D6).mutations&&0<g.P(b.frameworkUpdates,D6).mutations.length&&"ENTITY_MUTATION_TYPE_DELETE"===g.P(b.frameworkUpdates,D6).mutations[0].type){const d=g.dI(g.P(b.frameworkUpdates,
D6).mutations[0].entityKey).entityId;
await A6(d,a.j,c,a.C,a.B)}await Kib(g.P(b.frameworkUpdates,D6))}},Ijb=async function(a,b){const c=n6(b);
if(await $5(a.j,b.entityKey,"transfer"))return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{await Hjb(a,b)}catch(d){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Jjb=async function(a,b){const c=n6(b),d=await $5(a.j,b.entityKey,"transfer");
if(!d||"TRANSFER_STATE_COMPLETE"!==d.transferState)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{await Hjb(a,b,!0)}catch(e){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Kjb=async function(a,b){const c=n6(b),d=g.dI(b.entityKey).entityId,e=await X5(a.j,{mode:"readonly",
jc:!0},k=>{const l=Q5(k,b.entityKey,"transfer");let m=void 0;a.Y.N("html5_oduc_transfer_logging")&&(m=Q5(k,g.eI(d,"videoDownloadContextEntity"),"videoDownloadContextEntity"));return g.kw.all([l,m])}),[f,
h]=e;if(!f||"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"!==f.transferState)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{f.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";await Z5(a.j,f,"transfer");const k=g.dI(f.key).entityId;m6({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:k,ll:f,offlineModeType:null==h?void 0:h.offlineModeType})}catch(k){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Hjb=async function(a,b,c=!1){const d=g.P(b.actionMetadata,Ljb),e=g.dI(b.entityKey).entityId,f=g.eI(e,"downloadStatusEntity");
var h=await X5(a.j,{mode:"readonly",jc:!0},n=>{const p=Q5(n,f,"downloadStatusEntity");let q=void 0;a.Y.N("html5_oduc_transfer_logging")&&(q=Q5(n,g.eI(e,"videoDownloadContextEntity"),"videoDownloadContextEntity"));return g.kw.all([p,q])});
const [k,l]=h;h="TRANSFER_STATE_TRANSFER_IN_QUEUE";"DOWNLOAD_STATE_USER_DELETED"===(null==k?void 0:k.downloadState)&&(h="TRANSFER_STATE_PAUSED_BY_USER");const m={key:b.entityKey,transferState:h,cotn:g.Px(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:null==d?void 0:d.maximumDownloadQuality,preferredAudioTrack:null==d?void 0:d.preferredAudioTrack,transferRetryCount:0,isRefresh:c,hasLoggedFirstStarted:!1};await X5(a.j,{mode:"readwrite",jc:!0},n=>{const p=[];c&&p.push(W5(n,g.eI(e,
"offlineVideoStreams")));p.push(U5(n,m,"transfer"));return g.kw.all(p)});
m6({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:e,ll:m,offlineModeType:null==l?void 0:l.offlineModeType})},Njb=function(a,b,c,d){if(!a.action.entityKey)throw Error("entityKey is missing.");
const {yV:e,entityId:f}=g.dI(a.action.entityKey);a={entityType:e,entityId:f,offlineOrchestrationActionType:a.action.actionType,orchestrationAction:{orchestrationActionId:a.actionId}};b&&(a.offlineOrchestrationActionResult=b.status,a.isRetryable=c?!1:b.j,b.B&&(a.offlineOrchestrationFailureReason=Mjb(b.B,a.isRetryable)));d&&(a.additionalOrchestrationActions=d.map(h=>({orchestrationActionId:h.actionId})));
return a},Mjb=function(a,b){return"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"!==a||b?"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"===a&&b?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":a:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},L6=function(a,b){const c={offlineOrchestrationContext:Njb(a)};
b=Yib(b,c);Zib(Xib(),b,a.rootActionId)},M6=function(a,b,c,d=[]){b={offlineOrchestrationContext:Njb(a,b,c,d)};
b=Yib(3,b);Zib(Xib(),b,a.rootActionId)},Ojb=function(a,b){for(const c of b)L6(c,1),a.actions.push(c);
a.actions.sort(a.j)},Pjb=function(a,b){if(b)for(let c=0;c<a.actions.length;c++)a.actions[c].rootActionId===b&&a.actions[c].actionId!==b&&(a.actions.splice(c,1),c--)},Qjb=function(a,b){for(const c of a.actions)if(c.actionId===b)return!0;
return!1},Ujb=async function(a,b,c,d){a=new Rjb(a,b,c,d);
await Sjb(a);Tjb(a);return a},Sjb=async function(a){const b=await a6(a.A,"offlineOrchestrationActionWrapperEntity");
await N6(a,b)},Tjb=function(a){const b=a.j.actions[0];
return a.C?("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===(null==b?void 0:b.action.actionType)&&"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"!==a.C[0].action.actionType&&(a.D=!0),Promise.resolve()):Vjb(a)},Vjb=async function(a){if(a.C)throw Error("Already processing an action");
if(!a.isDisposed()){var b=a.j.actions.shift();hjb(a.Z,!b);if(void 0!==b){"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"===b.action.actionType&&"DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"===b.actionId&&Pjb(a.j,b.actionId);var c="";"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===b.action.actionType&&b.rootActionId===b.actionId&&(c=b.actionId);var d=[b];a.C=d;if(b=a.oa[b.entityType]){for(const e of d)L6(e,2);try{const e=await Ajb(b,d.map(f=>f.action));
for(const f of d){const h=e.get(f.action);await Wjb(a,f,h)}Pjb(a.j,c)}catch(e){j6("Orchestration error",e);try{await Xjb(a,d)}catch(f){j6("Orchestration retry error",f);for(const h of d)3>h.retryScheduleIndex&&Ojb(a.j,[h])}}finally{a.C=void 0}}else a.C=void 0;await Vjb(a)}}},Wjb=async function(a,b,c){const d=3===b.retryScheduleIndex+2;
if("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"===c.status){let e=void 0;try{let f;e=null==(f=c.C)?void 0:f.map(h=>a.createAction(h,b))}catch(f){M6(b,c,d);
k6(a.K,{entityKey:b.action.entityKey,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"});j6("Orchestration subactions creation error",f);return}M6(b,c,d,e);if(e){const f=e.map(k=>x6(k));
let h=0;for(;h<e.length&&!a.D;)await X5(a.A,{mode:"readwrite",jc:!0},k=>{const l=[];l.push(V5(k,f.slice(h,h+10),"offlineOrchestrationActionWrapperEntity"));return g.kw.all(l)}),h+=10;
if(a.D){a.D=!1;return}}c=x6(b);await Eib(a.A,c.key);L6(b,4)}else"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"===c.status&&(M6(b,c,d),c.j&&3>b.retryScheduleIndex+1?await Xjb(a,[b]):(k6(a.K,{entityKey:b.action.entityKey,failureReason:(null==c?0:c.A)?c.A:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN"}),j6("Orchestration result is not retryable, deleting action"),await Eib(a.A,x6(b).key)))},Xjb=async function(a,b){for(const d of b){var c=void 0;
let e=void 0;const f=(null==(e=d.action)?void 0:null==(c=e.actionMetadata)?void 0:c.retryScheduleIntervalsInSeconds)||[1,2,4];c=1;d.retryScheduleIndex<f.length&&(c=f[d.retryScheduleIndex]);d.j=1E3*c+Date.now();d.retryScheduleIndex++}await Yjb(a,b)},Zjb=async function(a,b){return(await a6(a.A,"offlineOrchestrationActionWrapperEntity",b)).filter(Lib)},N6=async function(a,b){let c=[];
var d=Infinity;let e=4E3;for(const h of b){b=Number(h.enqueueTimeSec);const k=$jb(b);var f=h.retryScheduleIndex;f=null!=f&&0<f;0<k&&f?(d=Math.min(d,b),e=Math.min(k,e)):c.push(h)}isFinite(d)&&(!a.B.isActive()||d<a.O)&&(a.O=d,a.B.start(e));a.J.Kh()||(d=c.length,c=c.filter(h=>{let k;h=(null==(k=h.actionProto)?void 0:k.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!akb.includes(h)}),d=c.length<d,!a.B.isActive()&&d&&a.B.start(1));
0<c.length&&bkb(a,c);await Tjb(a)},$jb=function(a){a=1E3*a-Date.now();
return 4E3<a?4E3:a},bkb=function(a,b){0!==b.length&&b.forEach(c=>{c=w6(c);
3>c.retryScheduleIndex&&Ojb(a.j,[c])})},ckb=async function(a){var b=await Zjb(a);
const c=[];for(const d of b)b=g.dI(d.key).entityId,Qjb(a.j,b)||c.push(d);await N6(a,c)},Yjb=function(a,b){if(0===b.length)return Promise.resolve([]);
b=b.map(c=>x6(c));
return Dib(a.A,b)},dkb=async function(a,b,c=!0){if(a.j){var d=[],e=g.zQ(a.j.j,c),f=[];
for(let h=0;h<e.length;h++)c=a.j.D(e[h],"json3"),c=g.wu(c,{withCredentials:!0,format:"RAW"},3,500).then(k=>{k={metadata:g.UN(e[h]),trackData:k.xhr.responseText};f.push(k)}).jk(k=>{j6("Caption fetch error",k)}),d.push(c);
await lib(d);try{await Pib(b,f)}catch(h){j6("Caption DB transaction error",h)}}},ekb=async function(a,b){const c=b.videoId,d=b.V();
let e=!0;if(b.captionTracks.length){const f=kib(b);a.j=new g.K1(d,b,f)}else if(b.Ec)a.j=new g.L1(d,b.Ec,c,g.rHa(b),b.Xl,b.eventId),e=b.Xl;else return;return new Promise(f=>{let h;null==(h=a.j)||h.J(async()=>{await dkb(a,c,e);f()})})},fkb=async function(a){a=await Qib(a);
return!!a&&0<a.length},gkb=async function(a){return Rib(a)},hkb=async function(a){return(await g.WFa(a)).filter(b=>!!b.url).map(b=>b.url)},O6=function(a,b){var c=g.fO(b);
if(1===c||0===c)return Promise.resolve();(c=ikb(a,b))&&c.stopVideo();a.B=0;return gkb(b)},ikb=function(a,b){let c;
return(null==(c=a.player)?void 0:c.getVideoData().videoId)===b?a.player:null},P6=function(a,b,c=!1,d=!0){const e="string"===typeof b?b:b.videoDetails.videoId;
2===g.fO(e)&&((b=ikb(a,e))?b.stopVideo():a.logger.info(()=>`Corresponding player for ${e} not found. Pausing anyway`),g.gO(e,2),a.B=2,c?jkb(a.j):d&&kkb(a.j))},lkb=async function(a,b){if(0===b.length)return[];
const c=b.map(e=>g.eI(e,"transfer")),d=(await a6(a.j,"transfer",c)).filter(Lib).map(e=>g.dI(e.key).entityId);
a=b.filter(e=>-1===d.indexOf(e));
if(0===a.length)return[];for(const e of a)await gkb(e);return a},okb=async function(a,b,c,d,e,f){let h="STREAM_TYPE_UNKNOWN";
c.video&&c.audio?(h="STREAM_TYPE_AUDIO_AND_VIDEO",j6("unexpected stream type")):c.video&&!c.audio?h="STREAM_TYPE_VIDEO":!c.video&&c.audio&&(h="STREAM_TYPE_AUDIO");const k=g.eI(b,"offlineVideoStreams"),l={numBytesDownloaded:e.toFixed(),numTotalBytes:f.toFixed(),streamType:h,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(d),itag:"STREAM_TYPE_AUDIO_AND_VIDEO"===h?Number(c.itag):void 0};await X5(a,{mode:"readwrite",jc:!0},m=>{const n=Q5(m,k,"offlineVideoStreams"),p=Q5(m,
g.eI(b,"transfer"),"transfer");return g.kw.all([n,p]).then(([q,t])=>{if(!t)return W5(m,k).then(()=>{});
var v=mkb(q);q=nkb(q,d,l,k);const A=U5(m,q,"offlineVideoStreams");mkb(q)>v&&(t.lastProgressTimeMs=Date.now().toString());v=[A];t.offlineVideoStreams||(t.offlineVideoStreams=[]);-1===t.offlineVideoStreams.indexOf(k)&&(t.offlineVideoStreams.push(k),v.push(U5(m,t,"transfer")));return g.kw.all(v)})})},pkb=async function(a,b){b=g.eI(b,"offlineVideoStreams");
if((b=await $5(a,b,"offlineVideoStreams"))&&b.streamsProgress){for(const c of b.streamsProgress)c.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",c.numTotalBytes!==c.numBytesDownloaded&&(c.numBytesDownloaded=c.numTotalBytes);await Z5(a,b,"offlineVideoStreams")}},nkb=function(a,b,c,d){if(a&&a.streamsProgress){d=a;
a:{b=`${b.itag};${b.xtags}`;var e=a.streamsProgress;for(let f=0;f<e.length;f++){const h=JSON.parse(e[f].formatStreamBytes);if(`${h.itag};${h.xtags}`===b){e[f]=c;c=e;break a}}e.push(c);c=e}d.streamsProgress=c}else a={key:d,streamsProgress:[c]};return a},mkb=function(a){if(null==a?0:a.streamsProgress){let b=0;
a=a.streamsProgress;for(let c=0;c<a.length;c++){const d=a[c];isNaN(Number(d.numBytesDownloaded))?j6("stream progress bytes number invalid"):b+=Number(d.numBytesDownloaded)}return b}return 0},jkb=async function(a){if(a.j){const b=a.j;
a.C.stop();await Q6(a,"TRANSFER_STATE_PAUSED_BY_USER");const c=(null==b?0:b.key)?g.dI(b.key).entityId:"";c&&a.B&&await r6(c,a.B,a.A,"DOWNLOAD_STATE_PAUSED");const d=await R6(a,c);kjb({videoId:c,ll:b,offlineModeType:d})}else S6(a,"onTransferPausedByUser");T6(a);U6(a)},kkb=async function(a){if(a.j){a.C.stop();
await Q6(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE");var b=a.j;(b=(null==b?0:b.key)?g.dI(b.key).entityId:"")&&a.B&&await r6(b,a.B,a.A,"DOWNLOAD_STATE_PAUSED");T6(a)}else S6(a,"onTransferPausedByNetwork")},V6=async function(a){if(a.j){a.C.start(108E5);
await Q6(a,"TRANSFER_STATE_TRANSFERRING");var b=a.j;(b=(null==b?0:b.key)?g.dI(b.key).entityId:"")&&a.B&&await r6(b,a.B,a.A,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS")}else S6(a,"onTransferStart")},qkb=async function(a,b,c){if(a.j){"TRANSFER_STATE_TRANSFERRING"!==a.j.transferState&&await V6(a);
var d=Date.now();1E3<d-a.Ba&&(a.Ba=d,await okb(a.A,c.videoId,c.A,c.xI,c.bytesDownloaded,c.j),!a.ma||a.ma&&d-a.Z>a.Qa)&&(a.Z=d,d=await R6(a,b),jjb({videoId:b,ll:a.j,offlineModeType:d},c.bytesDownloaded,c.j));a.C.start(108E5)}else S6(a,`onTransferProgress: ${b}`)},skb=async function(a){if(a.j){var b=a.j;
a.C.stop();if(b&&a.D){var c=njb(a.api.V(),b.cotn,a.D);await rkb(a,c)}await Q6(a,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE");(c=(null==b?0:b.key)?g.dI(b.key).entityId:"")&&a.B&&await r6(c,a.B,a.A,"DOWNLOAD_STATE_COMPLETE");await pkb(a.A,c);var d=await R6(a,c);m6({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",statusType:"SUCCESS"},{videoId:c,ll:b,offlineModeType:d});T6(a);U6(a)}else S6(a,"onTransferComplete")},tkb=async function(a){await Oib();
a=a.va;var b=g.eO();b=Object.keys(b);await lkb(a,b)},wkb=async function(a){a=(await a6(a.A,"transfer")).filter(ukb).sort(vkb);
if(0!==a.length)return a[0]},zkb=async function(a,b){if(!a.O){a.O=!0;
a.j=b;var c=g.dI(a.j.key).entityId;if("TRANSFER_STATE_TRANSFERRING"===a.j.transferState){var d=await R6(a,c);m6({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:c,ll:a.j,offlineModeType:d})}else"TRANSFER_STATE_TRANSFER_IN_QUEUE"!==a.j.transferState||a.j.transferRetryCount||a.j.hasLoggedFirstStarted||(d=await R6(a,c),a.j.hasLoggedFirstStarted=!0,await xkb(a),jjb({videoId:c,ll:a.j,offlineModeType:d},void 0,void 0,!0));await V6(a);c=null;try{c=await ykb(a,
b),a.D=c}catch(f){j6("error getting player response",f,b.cotn);await a.Ju("TRANSFER_FAILURE_REASON_INTERNAL");return}d=njb(a.api.V(),b.cotn,c);await rkb(a,d);d.Qu=await hkb(d.videoId);c=a.K;b=b.maximumDownloadQuality;d.getPlayerResponse();g.gO(d.videoId,2);c.B=2;c.A=!1;var e;null==(e=c.player)||e.dispose();c.player=c.api.Mw(9,d);g.Sz(c.player,{localmediachange:c.eF,signatureexpired:c.DK,statechange:c.C},c);e=c.MI(b);g.VUa(c.player,g.DK(e,e,!0,"m"),!1);g.oT(c.player,!1);a.C.start(108E5)}},T6=function(a){a.j=
void 0;
a.D=void 0;a.C.stop()},U6=async function(a,b=!1){if(a.j)throw Error("Already downloading a video");
a.Z=0;a.O=!1;const c=await wkb(a);ijb(a.Ka,!c);c&&a.J.Kh()?(b&&await new Promise(d=>{g.lu(d,1E3)}),await zkb(a,c)):!c&&a.j&&T6(a)},R6=async function(a,b){let c=void 0;
a.api.V().N("html5_oduc_transfer_logging")&&(c=await $5(a.A,g.eI(b,"videoDownloadContextEntity"),"videoDownloadContextEntity"));let d,e;return null!=(e=null==(d=c)?void 0:d.offlineModeType)?e:void 0},Akb=async function(a){a.D&&(await O6(a.K,a.D.videoDetails.videoId),T6(a))},rkb=async function(a,b){try{(b.captionTracks.length||b.Ec)&&!await fkb(b.videoId)&&await ekb(a.Ya,b)}catch(c){j6("Caption downloading error",c,b.cotn)}},xkb=async function(a,b){if(a.j){var c=a.j;
await X5(a.A,{mode:"readwrite",jc:!0},d=>{const e=[U5(d,c,"transfer")];b&&e.push(b(d));return g.kw.all(e)})}},ykb=async function(a,b){b=g.dI(b.key).entityId;
b=g.eI(b,"playbackData");a=await $5(a.A,b,"playbackData");if(null==a?0:a.playerResponseJson)return JSON.parse(a.playerResponseJson);throw Error("No PlayerResponse found");},Q6=async function(a,b,c,d){if(a.j){a.j.transferState=b;
a.j.failureReason=d;try{await xkb(a,e=>c?R5(e,"offlineVideoStreams",a.j.offlineVideoStreams).then(f=>{for(const h of f)if(h&&h.streamsProgress)for(const k of h.streamsProgress)k.streamState=c;return V5(e,f.filter(h=>!!h),"offlineVideoStreams")}):g.kw.resolve(void 0))}catch(e){e instanceof g.fw&&"QUOTA_EXCEEDED"===e.type&&await a.Ju("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE")}}else S6(a,`saveTransferState: ${b}`)},S6=function(a,b){a.api.xa("woffle",{mcte:b});
j6("missing current transfer entity.")},Bkb=function(a){const b=3>(a.j.transferRetryCount||0);
b&&(a=a.j,a.transferRetryCount=(a.transferRetryCount||0)+1);return b},Ckb=async function(a,b="TRANSFER_FAILURE_REASON_UNKNOWN"){a.j||S6(a,`setTransferToFailed: ${b}`);
var c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";"TRANSFER_FAILURE_REASON_NETWORK"===b?c="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"===b&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED");await Q6(a,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",b);var d;k6(a.ea,{entityKey:null==(d=a.j)?void 0:d.key,failureReason:c});c=a.j?g.dI(a.j.key).entityId:"";d=await R6(a,c);a={videoId:c,ll:a.j,offlineModeType:d};c=
{transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(c.transferFailureReason=b,c.failureReason=ljb(b));m6(c,a)},ukb=function(a){return void 0!==W6[a.transferState]},vkb=function(a,b){const c=W6[a.transferState],d=W6[b.transferState];
return c!==d?c-d:Number(a.enqueuedTimestampMs)-Number(b.enqueuedTimestampMs)},Dkb=async function(a){a.api.Ua("onOrchestrationBecameLeader");
await a.WL()},Gkb=async function(a){const b=await c6();
if(b){a.A=new Ekb(b,a.api,a.B,a.j);var c=a.D(b);a.J=await Ujb(b,c,a.B,a.j);await Fkb(a)}else j6("PES is undefined")},Fkb=async function(a){if(a.A){a.A.j||await U6(a.A);
await a.refreshAllStaleEntities(43200,!0);await a.O();a.ma=g.mu(()=>{a.refreshAllStaleEntities(43200,!0);a.O()},9E5);
g.Qv(g.Sv(),()=>a.nC());
var b=await c6();await ejb(b);gjb(a.B)}else j6("transferManager is undefined")},Hkb=async function(){const a=await c6();
if(!a)return[];const b=Date.now()/1E3,c=await a6(a,"offlineVideoPolicy");for(const d of c)d.expirationTimestamp&&Number(d.expirationTimestamp)<b&&(d.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE",await Z5(a,d,"offlineVideoPolicy"));return c.map(d=>d.key)},X6=async function(a,b,c,d,e){var f=await c6();
if(!f)return[];b=b.map(h=>{var k=g.eI(h,c);k={actionType:d,entityKey:k,actionMetadata:Object.assign({},ojb(),e)};"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"!==d&&(k.actionMetadata.priority=0);h=new v6(c,h,k);return x6(h)});
f=Dib(f,b);fjb(a.B);return f},Ikb=async function(a,b,c){const d=[];
for(const e of b)e.upToDate||c&&!e.shouldAutoSyncMetadata||!e.playlistId||(b=await X6(a,[e.playlistId],"mainPlaylistEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",{mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:e.checkInSeconds,autoSync:c}}))&&d.push(...b);return d},Kkb=async function(a){const b=g.RB();
a=Sib(a);const c=g.WA(Jkb);let d;try{d=await g.PB(b,a,c)}catch(e){throw j6("GetOffline fetch request error",e),Error("GetOffline fetch request error");}if(d){let e;if(0===(null==(e=d.errorMetadata)?void 0:e.status))throw Error("Empty response body");if(!d.videos||!d.videos.length)throw Error("No data");}else throw Error("Network request failed");return d.videos.map(e=>e.offlineVideoData)},Lkb=async function(a){const b=g.RB();
a=Tib(a);const c=g.WA(Jkb);let d;try{d=await g.PB(b,a,c)}catch(e){throw j6("GetOffline fetch request error for playlist",e),Error("GetOffline fetch request error for playlist");}if(d){let e;if(0===(null==(e=d.errorMetadata)?void 0:e.status))throw Error("Empty response body");if(!d.playlists||!d.playlists.length)throw Error("No data");}else throw Error("Network request failed");return d.playlists.map(e=>e.offlinePlaylistData)},Nkb=async function(a,b,c,d){const e=await c6();
if(!e)return[];var f=[];(null==d?0:d.length)?f=d:f=await a6(e,"mainPlaylistEntity");if(!f.length)return[];d=[];const h=Date.now()/1E3;for(const n of f){var k=n.downloadState?await $5(e,n.downloadState,"mainPlaylistDownloadStateEntity"):void 0;let p;var l=(f=null==(p=n)?void 0:p.entityMetadata)&&f.nextAutoRefreshIntervalSeconds?Number(f.nextAutoRefreshIntervalSeconds):NaN,m=Number.isNaN(l)?a:l;let q,t;const v=(null==(q=k)?0:q.lastSyncedTimestampMillis)?Number(null==(t=k)?void 0:t.lastSyncedTimestampMillis)/
1E3:0;let A,E;l=(null==(A=k)?0:A.addedTimestampMillis)?Number(null==(E=k)?void 0:E.addedTimestampMillis)/1E3:0;if(c||!f||v+m<=h){k=[];let H;if(null==(H=n.videos)?0:H.length)for(const K of n.videos)m=JSON.parse(g.dI(K).entityId),m.videoId&&k.push(m.videoId);m="0";if(f){let K;m=String(Number(null!=(K=f.offlineLastModifiedTimestampSeconds)?K:0).toFixed())}d.push({playlistId:n.playlistId,videoIds:k,offlineLastModifiedTimestamp:m,autoSync:b,offlineDateAddedTimestamp:String(l.toFixed())})}}return d.length?
await Mkb(d):[]},Okb=async function(){var a=await c6();
if(!a)return!1;a=await a6(a,"refresh");var b;if(null==(b=a[0])||!b.refreshTime)return!1;b=Number(a[0].refreshTime);a=Date.now()/1E3;return isFinite(b)&&a>=b},Qkb=async function(a,b){let c;
try{const d=await Pkb(a,b);await ujb(d);c=xjb(d)}catch(d){j6("getAndProcessSmartDownloadsResponse request or processing error",d)}return c},Rkb=async function(a,b){const c=await c6();
if(!c)return[];var d=[];(null==b?0:b.length)?d=b:d=await a6(c,"musicPlaylist");if(!d.length)return[];b=[];Date.now();for(const f of d){let h;d=null==(h=f)?void 0:h.entityMetadata;Number.isNaN(d&&d.nextAutoRefreshIntervalSeconds?Number(d.nextAutoRefreshIntervalSeconds):NaN);var e=d=0;if(f.downloadMetadata){e=await $5(c,f.downloadMetadata,"musicPlaylistDownloadMetadataEntity");let m,n;d=Number(null!=(n=null==(m=e)?void 0:m.addedTimestampMillis)?n:"0")/1E3;let p,q;e=Number(null!=(q=null==(p=e)?void 0:
p.lastModifiedTimestampMillis)?q:"0")/1E3}const k=[];let l;if(null==(l=f.tracks)?0:l.length)for(const m of f.tracks)k.push(g.dI(m).entityId);b.push({playlistId:f.playlistId,videoIds:k,offlineLastModifiedTimestamp:String(e.toFixed()),autoSync:a,offlineDateAddedTimestamp:String(d.toFixed())})}return b.length?await Mkb(b):[]},Pkb=async function(a,b){const c=g.RB();
var d=await c6();let e;d&&(e=await $ib(d));d=e;a={context:g.UA(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:a},offlineClientState:d,clientStateRequestData:{preferredFormatType:b}}}};b=g.WA(Skb);let f;try{f=await g.PB(c,a,b)}catch(h){throw j6("DPS fetch request error for smart downloads",h),Error("DPS fetch request error for smart downloads");}if(!f)throw Error("Network request failed");return f},Mkb=async function(a){const b=
g.RB();
a=Uib(a);const c=g.WA(Tkb);let d;try{d=await g.PB(b,a,c)}catch(e){throw j6("offlinePlaylistSyncCheck fetch request error",e),Error("offlinePlaylistSyncCheck fetch request error");}if(d){let e;if(0===(null==(e=d.errorMetadata)?void 0:e.status))throw Error("Empty response body");if(!d.offlinePlaylistSyncCheckDatas||!d.offlinePlaylistSyncCheckDatas.length)throw Error("No data");}else throw Error("Network request failed");return d.offlinePlaylistSyncCheckDatas.map(e=>e.offlinePlaylistSyncCheckData)},
Vkb=async function(a,b){const c=n6(b);
var d=g.dI(b.entityKey).entityId,e=[];try{e=await Ukb(a,d);let h;a.Y.N("woffle_enable_main_downloads_library")&&(null==(h=e)?0:h.length)&&await F6(a.j,[b.entityKey])}catch(h){return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.fw&&"QUOTA_EXCEEDED"===h.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,b,d)}a=[];var f;if(null==(f=e)?0:f.length)for(const h of e){e=h.offlineVideoData;let k;if(null==(k=e)?0:k.videoId){let l;f=Number((null==(l=b.actionMetadata)?void 0:l.priority)||0)+1;a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"mainVideoEntity",f,Y6,Z6(b,e,d)))}}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},Xkb=async function(a,b){const c=n6(b);
var d=b.entityKey,e=g.dI(d).entityId,f=[];let h=!1;"!*$_ALL_ENTITIES_!*$"===e?(h=!0,f=await a6(a.j,"mainPlaylistEntity")):(d=await $5(a.j,d,"mainPlaylistEntity"))&&f.push(d);var k;if(null==(k=f)||!k.length)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);d=g.P(b.actionMetadata,Wkb);k=null==d?void 0:d.nextAutoRefreshIntervalSeconds;const l=null==d?void 0:d.autoSync;let m=[],n=!0;d=!0;let p=!1;if(h||!1!==l){try{m=await Nkb(0,!!l,!0,f)}catch(Q){Q instanceof Error&&"No data"===Q.message?
"!*$_ALL_ENTITIES_!*$"===e?await C6(a.j,b,a.C,a.B):await B6(e,a.j,b,a.C,a.B):Q instanceof Error&&"Empty response body"===Q.message&&j6(Q.message)}if(!m.length||!h&&m[0].playlistId!==e)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)}if(h){b=[];for(var q of m)q.upToDate||l&&!q.shouldAutoSyncMetadata||!q.playlistId||b.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q.playlistId,"mainPlaylistEntity",0,Y6,{mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:q.checkInSeconds,
autoSync:l}}));return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,b)}if(m.length&&(q=m[0],p=!!q.upToDate,l)){var t;n=null!=(t=q.shouldAutoSyncMetadata)?t:!0;let Q;d=null!=(Q=q.shouldAutoSyncVideos)?Q:!0;q.checkInSeconds&&(k=q.checkInSeconds)}if(p||!n)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);q=[];f=f[0];t=f.downloadState?await $5(a.j,f.downloadState,"mainPlaylistDownloadStateEntity"):void 0;t=(null==t?0:t.addedTimestampMillis)?String(t.addedTimestampMillis):void 0;
try{q=await Ukb(a,e,t,k)}catch(Q){if(Q instanceof Error&&"No data"===Q.message)await B6(e,a.j,b,a.C,a.B);else if(Q instanceof Error&&"Empty response body"===Q.message)j6(Q.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.fw&&"QUOTA_EXCEEDED"===Q.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,b,e)}if(!d)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);a=[];k=new Map;var v;if(null==(v=q)?0:v.length)for(var A of q){v=A.offlineVideoData;var E=void 0;(null==(E=v)?0:E.videoId)&&k.set(v.videoId,v)}A=new Map;E=[];var H;if(null==f?0:null==(H=f.videos)?0:H.length)for(var K of f.videos)if(H=JSON.parse(g.dI(K).entityId).videoId)k.has(H)?(A.set(H,k.get(H)),k.delete(H)):E.push(H);let U;K=Number((null==(U=b.actionMetadata)?void 0:U.priority)||0)+1;for(const [Q,fa]of k.entries())a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",
Q,"mainVideoEntity",K,Y6,Z6(b,fa,e)));for(const [Q,fa]of A.entries())a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q,"mainVideoEntity",K,Y6,Z6(b,fa,e)));for(const Q of E)a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Q,"mainVideoEntity",0,Y6));return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},Ykb=async function(a,b){const c=n6(b);
try{const d=g.dI(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await C6(a.j,b,a.C,a.B):(await B6(d,a.j,b,a.C,a.B),a.Y.N("woffle_enable_main_downloads_library")&&await G6(a.j,b.entityKey))}catch(d){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Ukb=async function(a,b,c,d){b=await Lkb([b]);
const {mainPlaylistEntity:e,qY:f}=await Zkb(a,b[0],c,d);a=rjb(e,f.avatar);try{await z6(a)}catch(h){h instanceof Error&&"Failed to fetch"===h.message&&j6(h.message)}return b[0].videos},Z6=function(a,b,c){b={offlineVideoData:b,
playlistId:c};if(a=g.P(a.actionMetadata,Wkb))b.maximumDownloadQuality=a.maximumDownloadQuality;return{mainVideoEntityActionMetadata:b}},Zkb=async function(a,b,c,d){const e=Date.now().toString();
c||(c=e);var f=b.videos;const h=b.playlistId,k=[],l=[];if(f)for(var m of f){f=m.offlineVideoData;if(!f||!f.videoId)throw Error("Invalid offlineVideoData");f=f.videoId;f={id:g.eI(JSON.stringify({videoId:f,playlistId:h}),"mainPlaylistVideoEntity"),video:g.eI(f,"mainVideoEntity")};k.push(f);l.push(f.id)}m=b.channel.offlineChannelData;const n=$kb(g.eI(h,"ytMainChannelEntity"),m),p={key:g.eI(h,"mainPlaylistDownloadStateEntity"),addedTimestampMillis:c,lastSyncedTimestampMillis:e},q={key:g.eI(h,"mainPlaylistEntity"),
playlistId:h,channelOwner:n.id,videos:l,title:b.title,thumbnailStyleData:alb(b),visibility:blb(b),downloadState:p.key};(null==q?0:q.entityMetadata)?(q.entityMetadata.offlineLastModifiedTimestampSeconds=b.lastModifiedTimestamp,d&&(q.entityMetadata.nextAutoRefreshIntervalSeconds=String(d))):q&&(q.entityMetadata={nextAutoRefreshIntervalSeconds:d?String(d):void 0,offlineLastModifiedTimestampSeconds:b.lastModifiedTimestamp});await X5(a.j,{mode:"readwrite",jc:!0},t=>{const v=U5(t,q,"mainPlaylistEntity"),
A=U5(t,n,"ytMainChannelEntity"),E=U5(t,p,"mainPlaylistDownloadStateEntity"),H=[];for(const K of k)H.push(U5(t,K,"mainPlaylistVideoEntity"));return g.kw.all([v,A,E,...H])});
return{mainPlaylistEntity:q,qY:n,m4a:k}},$kb=function(a,b){return{id:a,
channelId:b.channelId,title:b.title,avatar:b.thumbnail}},alb=function(a){const b=[];
var c=a.videos;c&&0<c.length&&b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:c[0].offlineVideoData.thumbnail}}});if((a=a.additionalMetadadatas)&&0<a.length)for(const d of a){c=d.offlineBundleItemPlaylistData;let e;a=null==(e=c)?void 0:e.style;let f;c={collageThumbnail:{coverThumbnail:null==(f=c)?void 0:f.coverThumbnail}};switch(a){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),value:c});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),
value:c});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:c});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:c})}}return b},blb=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},elb=async function(a,b){const c=n6(b);
var d=g.dI(b.entityKey).entityId;const e=g.P(b.actionMetadata,$6),f=!(null==e?0:e.playlistId);try{await clb(a,d,void 0,null==e?void 0:e.offlineVideoData,f)}catch(k){return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.fw&&"QUOTA_EXCEEDED"===k.type&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,
d,b)}let h;a=Number((null==(h=b.actionMetadata)?void 0:h.priority)||0)+1;b=(b=g.P(b.actionMetadata,$6))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;d=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d,"playbackData",a,dlb,b);return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[d])},flb=async function(a,b){const c=n6(b),d=g.dI(b.entityKey).entityId;
var e=await $5(a.j,b.entityKey,"mainVideoEntity");const f=e?await $5(a.j,e.downloadState,"mainVideoDownloadStateEntity"):void 0;if(!e||!f)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);let h;try{let k;await clb(a,d,f.addedTimestampMillis,null==(k=g.P(b.actionMetadata,$6))?void 0:k.offlineVideoData);e=1;let l;e=Number((null==(l=b.actionMetadata)?void 0:l.priority)||0)+1;h=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"playbackData",e,dlb)}catch(k){if(k instanceof Error&&"No data"===
k.message)await A6(d,a.j,b,a.C,a.B);else if(k instanceof Error&&"Empty response body"===k.message)j6(k.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.fw&&"QUOTA_EXCEEDED"===k.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,a,b)}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,h?[h]:void 0)},glb=async function(a,b){const c=n6(b);
try{const d=g.dI(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await C6(a.j,b,a.C,a.B):(await A6(d,a.j,b,a.C,a.B),a.Y.N("woffle_enable_main_downloads_library")&&await G6(a.j,b.entityKey))}catch(d){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},clb=async function(a,b,c,d,e){d||(d=(await Kkb([b]))[0]);
const {mainVideoEntity:f,channelEntity:h}=await hlb(a,d,c,e);try{const l=u6(f.thumbnail),m=u6(h.avatar);var k=l.concat(m);await z6(k)}catch(l){l instanceof Error&&"Failed to fetch"===l.message&&j6(l.message)}},hlb=async function(a,b,c,d){c||(c=Date.now().toString());
let e;const f=null==(e=b.channel)?void 0:e.offlineChannelData,h={id:g.eI(b.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail},k={key:g.eI(b.videoId,"mainVideoDownloadStateEntity"),playbackData:g.eI(b.videoId,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.eI(b.videoId,"videoDownloadContextEntity")};c=g.eI(b.videoId,"mainVideoEntity");const l={key:c,videoId:b.videoId,title:b.title,thumbnail:b.thumbnail,localizedStrings:{viewCount:b.shortViewCountText},
lengthSeconds:b.lengthSeconds?Number(b.lengthSeconds):void 0,publishedTimestampMillis:b.publishedTimestamp?(1E3*Number(b.publishedTimestamp)).toString():void 0,formattedDescription:b.description,owner:h.id,downloadState:k.key};let m,n;a.Y.N("woffle_enable_main_downloads_library")&&d&&(d=await zjb(a.j,[c]))&&(m=d.mainDownloadsLibraryEntity,n=d.mainDownloadsListEntity);let p;p={key:g.eI(b.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"};g.tz(k,mjb,p);await X5(a.j,{mode:"readwrite",
jc:!0},q=>{var t=U5(q,h,"ytMainChannelEntity"),v=U5(q,k,"mainVideoDownloadStateEntity");const A=U5(q,l,"mainVideoEntity");t=[t,v,A];m&&(v=U5(q,m,"mainDownloadsLibraryEntity"),t.push(v));n&&(v=U5(q,n,"mainDownloadsListEntity"),t.push(v));p&&(q=U5(q,p,"downloadStatusEntity"),t.push(q));return g.kw.all(t)});
return{mainVideoEntity:l,channelEntity:h}},jlb=async function(a,b){const c=n6(b),d=[],e=await a7.getInstance();
let f,h;e&&(f=await e.get("sdois"),h=await (null==e?void 0:e.get("lmqf")));try{if(void 0===f)throw Error("prefStorage or opt-in state is undefined");const k=await yjb(a.j);k.reverse();if(k.length)for(const p of k){if(!p)continue;const q=g.dI(p).entityId;await A6(q,a.j,{entityKey:p,actionType:b.actionType},a.C,a.B)}let l;const m=await Pkb(f,null!=(l=h)?l:"SD");await ujb(m);const n=xjb(m);a.Y.N("woffle_enable_main_downloads_library")&&(f||await G6(a.j,E6),await F6(a.j,[E6]));if(null==n?0:n.length)for(const p of n){const q=
p.entityKey,t=p.actionMetadata;if(p.actionType&&q&&t&&!g.P(t,ilb)){const v=g.P(p.actionMetadata,$6);v&&(v.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",p.actionMetadata={mainVideoEntityActionMetadata:v});d.push(p)}}}catch(k){return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.fw&&"QUOTA_EXCEEDED"===k.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,a,b)}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,d)},klb=async function(a,b=43200,c=!0){if(!a.K.Kh())return[];
let d=[];try{d=await Nkb(b,c,!1)}catch(e){e instanceof Error&&"No data"===e.message||e instanceof Error&&"Empty response body"===e.message&&j6(e.message)}return Ikb(a,d,c)},llb=async function(a,b,c,d=!1){let e=[];
if(!await Okb()&&!d)return[];d=await c6();const f=await yjb(d);f.reverse();d=[];for(var h of f)h&&d.push(g.dI(h).entityId);b=await Qkb(b,c);if(null==b||!b.length)return[];d.length&&(c=await X6(a,d,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"),e=e.concat(c));for(const k of b)b=k.actionType,h=k.entityKey,c=k.actionMetadata,b&&h&&c&&!g.P(c,ilb)&&({entityId:h}=g.dI(h),b=await X6(a,[h],"mainVideoEntity",b,c),e=e.concat(b));return e},mlb=async function(){const a=await c6();
if(a){var b=await a6(a,"mainVideoEntity"),c=await a6(a,"mainPlaylistEntity"),d=g.eI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),e=await $5(a,d,"mainDownloadsListEntity");d=new Set;var f;if(null==e?0:null==(f=e.downloads)?0:f.length)for(var h of e.downloads){var k=void 0;(f=null!=(k=h.videoItem)?k:h.playlistItem)&&d.add(f)}h=new Set;k=[];for(const l of c){if(l.videos)for(const m of l.videos)(c=JSON.parse(g.dI(m).entityId).videoId)&&h.add(c);l.key&&!d.has(l.key)&&k.push(l.key)}for(const l of b)l.key&&
!d.has(l.key)&&(b=g.dI(l.key).entityId,h.has(b)||k.push(l.key));k.length&&await F6(a,k)}},b7=async function(a,b,c,d){const e=g.eI(a,"musicTrack"),f=g.eI(a,"transfer");
var h=await X5(b,{mode:"readonly",jc:!0},v=>g.kw.all([Q5(v,e,"musicTrack"),Q5(v,f,"transfer"),R5(v,"musicTrack"),R5(v,"offlineOrchestrationActionWrapperEntity")]));
const [k,l,m,n]=h;k&&(h=await nlb(k,m),await y6(h));const p=[],q=g.eI(a,"musicTrack");for(const v of n){h=g.dI(v.key).entityId;var t=w6(v);t=g.dI(t.action.entityKey).entityId;h!==a&&t!==a||s6(c,v.actionProto)||p.push(v.key)}await X5(b,{mode:"readwrite",jc:!0},v=>{const A=p.map(E=>W5(v,E));
A.push(W5(v,q,{At:!0}));return g.kw.all(A)});
t6(l);k6(d,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},c7=async function(a,b,c,d){const e=g.eI(a,"musicPlaylist"),f=g.eI("music_downloads_library_id","musicDownloadsLibraryEntity");
var h=await X5(b,{mode:"readonly",jc:!0},t=>g.kw.all([Q5(t,e,"musicPlaylist"),Q5(t,f,"musicDownloadsLibraryEntity"),R5(t,"musicPlaylist"),R5(t,"offlineOrchestrationActionWrapperEntity")]));
const [k,l,m,n]=h;k&&(h=await nlb(k,m),await y6(h));const p=[];for(const t of n){h=g.dI(t.key).entityId;const v=w6(t);h!==a&&v.rootActionId!==a||s6(c,t.actionProto)||p.push(t.key)}const q=g.eI(a,"musicPlaylist");await X5(b,{mode:"readwrite",jc:!0},t=>{const v=p.map(A=>W5(t,A));
v.push(W5(t,q,{At:!0}));return g.kw.all(v)});
if(k&&(a=await olb(k,m,l),a.reverse(),a.length))for(const t of a)(a=g.dI(t).entityId)&&await b7(a,b,c,d)},d7=async function(a,b,c){a=await X5(a,{mode:"readwrite",
jc:!0},d=>{const e=R5(d,"transfer"),f=R5(d,"offlineOrchestrationActionWrapperEntity");return g.kw.all([e,f]).then(([h,k])=>{const l=plb.map(m=>zib(d,m));
for(const m of k){k="musicTrack"===g.dI(m.actionProto.entityKey).entityType;const n="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===m.actionProto.actionType;s6(b,m.actionProto)||k&&(!k||n)||l.push(W5(d,m.key,{At:!0}))}return g.kw.all(l).then(()=>h)})});
for(const d of a)t6(d),a=g.dI(d.key).entityId,a=g.eI(a,"musicTrack"),k6(c,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});await pjb()},qlb=function(a){let b;
for(const k of a.additionalMetadatas)k.offlineMusicVideoData&&(b=k.offlineMusicVideoData);let c,d,e,f,h;return{id:g.eI(a.videoId,"musicTrack"),videoId:a.videoId,title:a.title,thumbnailDetails:a.thumbnail,lengthMs:String(1E3*Number(a.lengthSeconds)),albumTitle:null==(c=b)?void 0:c.releaseTitle,musicVideoType:null==(d=b)?void 0:d.musicVideoType,contentRating:{explicitType:null==(e=b)?void 0:e.explicitType},artistNames:(null==(f=b)?void 0:f.byline)||(null==(h=b)?void 0:h.channelName),downloadMetadata:g.eI(a.videoId,
"musicTrackDownloadMetadataEntity")}},olb=async function(a,b,c){const d=[],e=new Set;
let f;if(null==c?0:null==(f=c.downloadedTracks)?0:f.length)for(const h of c.downloadedTracks)e.add(h);if(a.tracks){for(const h of a.tracks)e.has(h)||d.push(h);for(const h of b)if(h.id!==a.id&&(b=h.tracks))for(const k of b)b=d.indexOf(k),-1!==b&&d.splice(b,1)}return d},nlb=async function(a,b){const c=u6(a.thumbnailDetails);
for(const d of b)if(d.id!==a.id)for(const e of u6(d.thumbnailDetails))b=c.indexOf(e),-1!==b&&c.splice(b,1);return c},rlb=async function(a,b){var c=g.eI("music_downloads_library_id","musicDownloadsLibraryEntity");
let d=await $5(a,c,"musicDownloadsLibraryEntity");d||(d={id:c});c=g.dI(b).entityType;if("musicTrack"===c){let e;if(null==(e=d.downloadedTracks)||!e.includes(b)){let f;d.downloadedTracks=(null!=(f=d.downloadedTracks)?f:[]).concat(b)}}else if("musicPlaylist"===c){let e;if(null==(e=d.downloadedPlaylists)||!e.includes(b)){let f;d.downloadedPlaylists=(null!=(f=d.downloadedPlaylists)?f:[]).concat(b)}}await Z5(a,d,"musicDownloadsLibraryEntity")},slb=async function(a,b){var c=g.eI("music_downloads_library_id",
"musicDownloadsLibraryEntity");
if(c=await $5(a,c,"musicDownloadsLibraryEntity")){const e=g.dI(b).entityType;let f;"musicTrack"===e?f=c.downloadedTracks:"musicPlaylist"===e&&(f=c.downloadedPlaylists);var d;if(null==(d=f)?0:d.length)for(d=0;d<f.length;d++)if(f[d]===b){f.splice(d,1);break}await Z5(a,c,"musicDownloadsLibraryEntity")}},ulb=async function(a,b){const c=n6(b),d=g.dI(b.entityKey).entityId;
var e=[];try{e=await tlb(a,d);let k;(null==(k=e)?0:k.length)&&await rlb(a.j,b.entityKey)}catch(k){b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";var f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED";k instanceof g.fw&&"QUOTA_EXCEEDED"===k.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE");return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,f)}a=[];var h;if(null==(h=e)?0:h.length)for(f of e){e=f.offlineVideoData;
let k;if(null==(k=e)?0:k.videoId){let l;h=Number((null==(l=b.actionMetadata)?void 0:l.priority)||0)+1;a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"musicTrack",h,e7,f7(b,e)))}}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},wlb=async function(a,b){const c=n6(b);
var d=b.entityKey,e=g.dI(d).entityId,f=[];let h=!1;"!*$_ALL_ENTITIES_!*$"===e?(h=!0,f=await a6(a.j,"musicPlaylist")):(d=await $5(a.j,d,"musicPlaylist"))&&f.push(d);var k;if(null==(k=f)||!k.length)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);var l;d=null==(l=g.P(b.actionMetadata,vlb))?void 0:l.autoSync;let m=[],n=!0;l=!0;let p=!1;k=void 0;if(h||!1!==d){try{m=await Rkb(!!d,f)}catch(Q){Q instanceof Error&&"No data"===Q.message?"!*$_ALL_ENTITIES_!*$"===e?await d7(a.j,b,a.B):await c7(e,
a.j,b,a.B):Q instanceof Error&&"Empty response body"===Q.message&&j6(Q.message)}if(!m.length||!h&&m[0].playlistId!==e)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)}if(h){b=[];for(var q of m)q.upToDate||d&&!q.shouldAutoSyncMetadata||!q.playlistId||b.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q.playlistId,"musicPlaylist",0,e7,{musicPlaylistEntityActionMetadata:{autoSync:d}}));return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,b)}if(m.length&&(q=m[0],p=!!q.upToDate,
d)){var t;n=null!=(t=q.shouldAutoSyncMetadata)?t:!0;let Q;l=null!=(Q=q.shouldAutoSyncVideos)?Q:!0;q.checkInSeconds&&(k=q.checkInSeconds)}if(p||!n)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);q=[];f=f[0];t=void 0;if(f.downloadMetadata){t=await $5(a.j,f.downloadMetadata,"musicPlaylistDownloadMetadataEntity");let Q;t=Number(null!=(Q=null==t?void 0:t.addedTimestampMillis)?Q:"0")/1E3}try{let Q;q=await tlb(a,e,null==(Q=t)?void 0:Q.toString(),k)}catch(Q){if(Q instanceof Error&&"No data"===
Q.message)await c7(e,a.j,b,a.B);else if(Q instanceof Error&&"Empty response body"===Q.message)j6(Q.message);else{b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";var v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED";Q instanceof g.fw&&"QUOTA_EXCEEDED"===Q.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE");return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,v)}}if(!l)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c);a=[];e=new Map;var A;if(null==(A=q)?0:A.length)for(var E of q){A=E.offlineVideoData;var H=void 0;(null==(H=A)?0:H.videoId)&&e.set(A.videoId,A)}E=new Map;H=[];var K;if(null==f?0:null==(K=f.tracks)?0:K.length)for(var U of f.tracks)if(K=g.dI(U).entityId)e.has(K)?(E.set(K,e.get(K)),e.delete(K)):H.push(K);U=Number((null==(v=b.actionMetadata)?void 0:v.priority)||0)+1;for(const [Q,fa]of e.entries())a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q,"musicTrack",U,e7,f7(b,fa)));for(const [Q,fa]of E.entries())a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Q,"musicTrack",U,e7,f7(b,fa)));for(const Q of H)a.push(H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Q,"musicTrack",0,e7));return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},xlb=async function(a,b){const c=n6(b);
try{const d=g.dI(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await d7(a.j,b,a.B):(await c7(d,a.j,b,a.B),await slb(a.j,b.entityKey))}catch(d){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},tlb=async function(a,b,c,d){b=await Lkb([b]);
({musicPlaylistEntity:a}=await ylb(a,b[0],c,d));a=u6(a.thumbnailDetails);await z6(a);return b[0].videos},f7=function(a,b){b={track:qlb(b)};
if(a=g.P(a.actionMetadata,vlb))b.maximumDownloadQuality=a.maximumDownloadQuality;return{musicTrackEntityActionMetadata:b}},ylb=async function(a,b,c,d){var e=b.videos;
const f=b.playlistId,h=[],k=[],l=[];c=c?(1E3*Number(c)).toString():Date.now().toString();if(e)for(var m of e){var n=m.offlineVideoData.videoId;e={id:g.eI(n,"musicTrack")};n=g.eI(n,"musicTrackDownloadMetadataEntity");h.push(e);k.push(e.id);l.push(n)}m=b.lastModifiedTimestamp?(1E3*Number(b.lastModifiedTimestamp)).toString():"0";const p={id:g.eI(f,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:l,lastModifiedTimestampMillis:m,addedTimestampMillis:c,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},
q={id:g.eI(f,"musicPlaylist"),title:b.title,playlistId:f,thumbnailDetails:b.thumbnail,visibility:zlb(b),trackCount:b.totalVideoCount,tracks:k,downloadMetadata:p.id};d&&((null==q?0:q.entityMetadata)?q.entityMetadata.nextAutoRefreshIntervalSeconds=String(d):q&&(q.entityMetadata={nextAutoRefreshIntervalSeconds:String(d)}));await X5(a.j,{mode:"readwrite",jc:!0},t=>{const v=U5(t,q,"musicPlaylist"),A=[];for(const E of h)A.push(U5(t,E,"musicTrack"));t=U5(t,p,"musicPlaylistDownloadMetadataEntity");return g.kw.all([v,
...A,t])});
return{musicPlaylistEntity:q,V4a:h}},zlb=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Dlb=async function(a,b){const c=n6(b);
var d=g.dI(b.entityKey).entityId;const e=g.P(b.actionMetadata,Alb);try{await Blb(a,d,void 0,null==e?void 0:e.track),(null==e?0:e.playlistId)||await rlb(a.j,b.entityKey)}catch(h){return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.fw&&"QUOTA_EXCEEDED"===h.type&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,d,b)}let f;a=Number((null==(f=b.actionMetadata)?void 0:f.priority)||0)+1;b=(b=g.P(b.actionMetadata,Alb))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;d=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d,"playbackData",a,Clb,b);return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[d])},Elb=async function(a,b){const c=n6(b),d=g.dI(b.entityKey).entityId,e=await $5(a.j,b.entityKey,"musicTrack"),f=e?await $5(a.j,e.downloadMetadata,"musicTrackDownloadMetadataEntity"):
void 0;
if(!e||!f)return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);let h;try{await Blb(a,d,f.addedTimestampMillis);let k;const l=Number((null==(k=b.actionMetadata)?void 0:k.priority)||0)+1;h=H6("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"playbackData",l,Clb)}catch(k){if(k instanceof Error&&"No data"===k.message)await b7(d,a.j,b,a.B);else if(k instanceof Error&&"Empty response body"===k.message)j6(k.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",
k instanceof g.fw&&"QUOTA_EXCEEDED"===k.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,a,b)}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,h?[h]:void 0)},Flb=async function(a,b){const c=n6(b);
try{const d=g.dI(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await d7(a.j,b,a.B):(await b7(d,a.j,b,a.B),await slb(a.j,b.entityKey))}catch(d){return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Blb=async function(a,b,c,d){d||(d=(await Kkb([b]))[0],d=qlb(d));
a=await Glb(a,d,b,c);await z6(u6(a.thumbnailDetails))},Glb=async function(a,b,c,d){d||(d=Date.now().toString());
const e={id:g.eI(c,"musicTrackDownloadMetadataEntity"),playbackData:g.eI(c,"playbackData"),addedTimestampMillis:d,videoDownloadContextEntity:g.eI(c,"videoDownloadContextEntity")};await X5(a.j,{mode:"readwrite",jc:!0},f=>{const h=U5(f,e,"musicTrackDownloadMetadataEntity");f=U5(f,b,"musicTrack");return g.kw.all([h,f])});
await r6(c,"musicTrackDownloadMetadataEntity",a.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD");return b},Hlb=function(a){let b,c;
a=g.P(null==(c=a.Id)?void 0:c.currentVideoEndpoint,g.EO);if(null==a?0:a.playlistId)b=a.playlistId;return b},Ilb=async function(a,b){const c=b.clientPlaybackNonce,d={cpn:c,
offlineSourceVisualElement:g.Xy(b.oa||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};b.A&&(d.videoFmt=Number(b.A.itag));b.C&&(d.audioFmt=Number(b.C.itag));const e=Hlb(b);var f;if(f=e&&b.videoId)b=b.videoId,f=await ("PPSV"!==e?Promise.resolve(!1):a.j.ea(b));f&&(d.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");a.A=c;g.Yv("offlinePlaybackStarted",d)},g7=class{constructor(a){this.j=a}},h7=class extends g7{get entityMetadata(){return this.j.entityMetadata}set entityMetadata(a){this.j.entityMetadata=
a}},Jlb=class extends g7{A(){const a=[];
this.j.video&&a.push(this.j.video);return[...(new Set(a))]}},Klb=class extends g7{A(){const a=[];this.j.video&&a.push(this.j.video);this.j.playlist&&a.push(this.j.playlist);this.j.videoItem&&a.push(this.j.videoItem);this.j.playlistItem&&a.push(this.j.playlistItem);return[...(new Set(a))]}},Llb=class extends g7{A(){const a=[];this.j.localImageEntities&&a.push(...this.j.localImageEntities);this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[...(new Set(a))]}},Mlb=class extends g7{A(){const a=
[];this.j.recommendedVideoMetadata&&a.push(...(new Llb(this.j.recommendedVideoMetadata)).A());return[...(new Set(a))]}},Nlb=class extends g7{A(){const a=[];this.j.playbackPosition&&a.push(this.j.playbackPosition);return[...(new Set(a))]}},Olb=class extends g7{A(){const a=[];this.j.creatorEntity&&a.push(this.j.creatorEntity);return[...(new Set(a))]}},Skb=["browse","music/browse","unplugged/browse"],Tkb=["offline/playlist_sync_check"],Jkb=["offline"],Gjb=["offline/get_playback_data_entity"],a7=class{constructor(a){this.token=
a}static async getInstance(){return new Promise(a=>{g.Jw().then(b=>{b?(a7.instance||(a7.instance=new a7(b)),a(a7.instance)):a(void 0)})})}async get(a){if(a=await (await J5(this.token)).get("prefs",a)){var b=(0,g.S)();
if(!(a.expirationTimestampMs<=b))return a.value}}async set(a,b,c=31536E3){const d=(0,g.S)();a={key:a,value:b,expirationTimestampMs:d+1E3*c};await g.vw(await J5(this.token),"prefs",a)}async remove(a){await (await J5(this.token)).delete("prefs",a)}},L5,Plb={INVALID_ENCODER_VERSION:"Invalid encoder version",KEY_CREATION_FAILED:"Failed to create encoder key",UNKNOWN_DECODE_ERROR:"Failed to decode PES data",UNKNOWN_ENCODE_ERROR:"Failed to encode PES data",WRONG_DATA_TYPE:"Encoder cannot process the data type"},
M5=class extends g.Ov{constructor(a,b={}){super(Plb[a],Object.assign({},{name:"PESEncoderError",type:a},b));this.type=a;this.level="WARNING";Object.setPrototypeOf(this,M5.prototype)}},Qlb=class{},Rlb=class extends Qlb{constructor(a){super();this.j=a}B(a,b){b=N5(b);a=(new TextEncoder).encode(JSON.stringify(a));return this.j.encrypt(a,b)}A(a,b){if(!(a instanceof Uint8Array))throw new M5("WRONG_DATA_TYPE",{ZO:1});const c=new TextDecoder;b=N5(b);a=this.j.decrypt(a,b);return JSON.parse(c.decode(a))}},
tib={buttonEntity:class extends h7{A(){return[]}},captionTrack:class extends h7{A(){return[]}},channelHandle:class extends h7{A(){return[]}},commerceAcquisitionClientPayloadEntity:class extends h7{A(){return[]}},commerceCartListEntity:class extends h7{A(){return[]}},continuationTokenEntity:class extends h7{A(){return[]}},downloadQualityPickerEntity:class extends h7{A(){return[]}},downloadsPageRefreshTokenEntity:class extends h7{A(){return[]}},downloadsPageViewConfigurationEntity:class extends h7{A(){return[]}},
downloadStatusEntity:class extends h7{A(){return[]}},emojiFountainDataEntity:class extends h7{A(){return[]}},fakeChannel:class extends h7{A(){const a=[];this.j.alternateChannel&&a.push(this.j.alternateChannel);this.j.alternateChannelList&&a.push(...this.j.alternateChannelList);this.j.oneofChannelEntity&&a.push(this.j.oneofChannelEntity);return[...(new Set(a))]}},fakePlaylist:class extends h7{A(){const a=[];this.j.entryCollection&&a.push(this.j.entryCollection);return[...(new Set(a))]}},fakePlaylistEntryCollection:class extends h7{A(){const a=
[];this.j.parentPlaylist&&a.push(this.j.parentPlaylist);if(this.j.entries)for(const b of this.j.entries)a.push(...(new Jlb(b)).A());return[...(new Set(a))]}},fakeVideo:class extends h7{A(){const a=[];this.j.descriptionEntity&&a.push(this.j.descriptionEntity);this.j.creators&&a.push(...this.j.creators);this.j.theBiggestFan&&a.push(this.j.theBiggestFan);return[...(new Set(a))]}},fakeVideoDescription:class extends h7{A(){return[]}},featuredProductsEntity:class extends h7{A(){return[]}},flowStateEntity:class extends h7{A(){return[]}},
iconBadgeEntity:class extends h7{A(){return[]}},interstitialInteractionStateEntity:class extends h7{A(){return[]}},liveChatPollStateEntity:class extends h7{A(){return[]}},logoEntity:class extends h7{A(){return[]}},macroMarkerEntity:class extends h7{A(){return[]}},mainDownloadsLibraryEntity:class extends h7{A(){const a=[];this.j.downloadsList&&a.push(this.j.downloadsList);this.j.smartDownloadsList&&a.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&a.push(this.j.recommendedDownloadsList);
return[...(new Set(a))]}},mainDownloadsListEntity:class extends h7{A(){const a=[];this.j.refresh&&a.push(this.j.refresh);if(this.j.downloads)for(const b of this.j.downloads)a.push(...(new Klb(b)).A());return[...(new Set(a))]}},mainPlaylistDownloadStateEntity:class extends h7{A(){const a=[];this.j.localImageEntities&&a.push(...this.j.localImageEntities);return[...(new Set(a))]}},mainPlaylistEntity:class extends h7{A(){const a=[];this.j.channelOwner&&a.push(this.j.channelOwner);this.j.videos&&a.push(...this.j.videos);
this.j.collaboratorChannels&&a.push(...this.j.collaboratorChannels);this.j.downloadState&&a.push(this.j.downloadState);this.j.refresh&&a.push(this.j.refresh);return[...(new Set(a))]}},mainPlaylistVideoEntity:class extends h7{A(){const a=[];this.j.video&&a.push(this.j.video);this.j.channelContributor&&a.push(this.j.channelContributor);return[...(new Set(a))]}},mainVideoDownloadStateEntity:class extends h7{A(){const a=[];this.j.playbackData&&a.push(this.j.playbackData);this.j.localImageEntities&&a.push(...this.j.localImageEntities);
this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[...(new Set(a))]}},mainVideoEntity:class extends h7{A(){const a=[];this.j.owner&&a.push(this.j.owner);this.j.downloadState&&a.push(this.j.downloadState);this.j.userState&&a.push(...(new Nlb(this.j.userState)).A());this.j.additionalMetadata&&a.push(...(new Mlb(this.j.additionalMetadata)).A());return[...(new Set(a))]}},markersEngagementPanelSyncEntity:class extends h7{A(){return[]}},markersVisibilityOverrideEntity:class extends h7{A(){return[]}},
musicAlbumReleaseDetail:class extends h7{A(){const a=[];this.j.albumRelease&&a.push(this.j.albumRelease);this.j.tracks&&a.push(...this.j.tracks);return[...(new Set(a))]}},musicAlbumReleaseDownloadMetadataEntity:class extends h7{A(){const a=[];this.j.trackDownloadMetadatas&&a.push(...this.j.trackDownloadMetadatas);return[...(new Set(a))]}},musicAlbumRelease:class extends h7{A(){const a=[];this.j.musicLibraryStatusEntity&&a.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&a.push(...this.j.primaryArtists);
this.j.details&&a.push(this.j.details);this.j.userDetails&&a.push(this.j.userDetails);this.j.tracks&&a.push(...this.j.tracks);this.j.share&&a.push(this.j.share);this.j.downloadMetadata&&a.push(this.j.downloadMetadata);this.j.refresh&&a.push(this.j.refresh);return[...(new Set(a))]}},musicAlbumReleaseUserDetail:class extends h7{A(){const a=[];this.j.albumRelease&&a.push(this.j.albumRelease);return[...(new Set(a))]}},musicArtistDetail:class extends h7{A(){const a=[];this.j.parentArtist&&a.push(this.j.parentArtist);
return[...(new Set(a))]}},musicArtist:class extends h7{A(){const a=[];this.j.details&&a.push(this.j.details);this.j.userDetails&&a.push(this.j.userDetails);return[...(new Set(a))]}},musicArtistUserDetail:class extends h7{A(){const a=[];this.j.parentArtist&&a.push(this.j.parentArtist);return[...(new Set(a))]}},musicDownloadsLibraryEntity:class extends h7{A(){const a=[];this.j.downloadedTracks&&a.push(...this.j.downloadedTracks);this.j.smartDownloadedTracks&&a.push(...this.j.smartDownloadedTracks);
this.j.downloadedEpisodes&&a.push(...this.j.downloadedEpisodes);this.j.downloadedAlbumReleases&&a.push(...this.j.downloadedAlbumReleases);this.j.smartDownloadedAlbumReleases&&a.push(...this.j.smartDownloadedAlbumReleases);this.j.downloadedPlaylists&&a.push(...this.j.downloadedPlaylists);this.j.smartDownloadedPlaylists&&a.push(...this.j.smartDownloadedPlaylists);this.j.metadataOnlyTracks&&a.push(...this.j.metadataOnlyTracks);return[...(new Set(a))]}},musicLibraryEdit:class extends h7{A(){return[]}},
musicLibraryStatusEntity:class extends h7{A(){return[]}},musicPlaylist:class extends h7{A(){const a=[];this.j.tracks&&a.push(...this.j.tracks);this.j.refresh&&a.push(this.j.refresh);this.j.musicLibraryStatusEntity&&a.push(this.j.musicLibraryStatusEntity);this.j.details&&a.push(this.j.details);this.j.downloadMetadata&&a.push(this.j.downloadMetadata);this.j.sideloadMetadata&&a.push(this.j.sideloadMetadata);this.j.userDetails&&a.push(this.j.userDetails);this.j.entryCollection&&a.push(this.j.entryCollection);
this.j.share&&a.push(this.j.share);this.j.podcastShowAdditionalMetadata&&a.push(...(new Olb(this.j.podcastShowAdditionalMetadata)).A());return[...(new Set(a))]}},musicPlaylistDownloadMetadataEntity:class extends h7{A(){const a=[];this.j.trackDownloadMetadatas&&a.push(...this.j.trackDownloadMetadatas);return[...(new Set(a))]}},musicShare:class extends h7{A(){return[]}},musicTrackDetail:class extends h7{A(){const a=[];this.j.parentTrack&&a.push(this.j.parentTrack);return[...(new Set(a))]}},musicTrackDownloadMetadataEntity:class extends h7{A(){const a=
[];this.j.playbackData&&a.push(this.j.playbackData);this.j.localImageEntities&&a.push(...this.j.localImageEntities);this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[...(new Set(a))]}},musicTrack:class extends h7{A(){const a=[];this.j.musicLibraryStatusEntity&&a.push(this.j.musicLibraryStatusEntity);this.j.artists&&a.push(...this.j.artists);this.j.audioModeVersion&&a.push(this.j.audioModeVersion);this.j.videoModeVersion&&a.push(this.j.videoModeVersion);this.j.userDetails&&
a.push(this.j.userDetails);this.j.details&&a.push(this.j.details);this.j.albumRelease&&a.push(this.j.albumRelease);this.j.share&&a.push(this.j.share);this.j.libraryEdit&&a.push(this.j.libraryEdit);this.j.downloadMetadata&&a.push(this.j.downloadMetadata);this.j.playbackPosition&&a.push(this.j.playbackPosition);return[...(new Set(a))]}},musicTrackUserDetail:class extends h7{A(){const a=[];this.j.parentTrack&&a.push(this.j.parentTrack);return[...(new Set(a))]}},offlineOrchestrationActionWrapperEntity:class extends h7{A(){return[]}},
offlineVideoPolicy:class extends h7{A(){return[]}},offlineVideoStreams:class extends h7{A(){return[]}},offlineabilityEntity:class extends h7{A(){return[]}},orchestrationWebSamplingEntity:class extends h7{A(){const a=[];this.j.fakeChildren&&a.push(...this.j.fakeChildren);return[...(new Set(a))]}},pinnedProductEntity:class extends h7{A(){return[]}},playbackData:class extends h7{A(){const a=[];this.j.transfer&&a.push(this.j.transfer);this.j.adsPlaybackData&&a.push(...this.j.adsPlaybackData);this.j.drmLicense&&
a.push(this.j.drmLicense);this.j.offlineVideoPolicy&&a.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[...(new Set(a))]}},playerStateEntity:class extends h7{A(){return[]}},quantityIncrementerEntity:class extends h7{A(){return[]}},refresh:class extends h7{A(){return[]}},saveToPlaylistListEntity:class extends h7{A(){return[]}},settingEntity:class extends h7{A(){return[]}},transfer:class extends h7{A(){const a=[];this.j.offlineVideoStreams&&
a.push(...this.j.offlineVideoStreams);this.j.captionTrack&&a.push(...this.j.captionTrack);return[...(new Set(a))]}},trendingOfferEntity:class extends h7{A(){return[]}},videoDownloadContextEntity:class extends h7{A(){return[]}},videoPlaybackPositionEntity:class extends h7{A(){return[]}},ytMainChannelEntity:class extends h7{A(){const a=[];this.j.userChannelDetails&&a.push(this.j.userChannelDetails);return[...(new Set(a))]}},ytMainDownloadedVideoEntity:class extends h7{A(){const a=[];this.j.video&&a.push(this.j.video);
this.j.playbackData&&a.push(this.j.playbackData);this.j.offlineVideoPolicy&&a.push(this.j.offlineVideoPolicy);return[...(new Set(a))]}},ytMainVideoEntity:class extends h7{A(){const a=[];this.j.channelOwner&&a.push(this.j.channelOwner);this.j.playbackPosition&&a.push(this.j.playbackPosition);this.j.localImageEntities&&a.push(...this.j.localImageEntities);this.j.downloadStatus&&a.push(this.j.downloadStatus);return[...(new Set(a))]}}},Cib=class{constructor(a,b){this.j=a;this.A=b;this.B={}}},Slb=class extends Qlb{B(a){return a}A(a){if(a instanceof
Uint8Array)throw new M5("WRONG_DATA_TYPE",{ZO:0});return a}},Fib=class{constructor(){this.j={};this.j[0]=new Slb;if(!g.N("aes_pes_encoder_killswitch")){var a=this.j;try{const d=g.Mv();var b=N5(d);var c=new Rlb(new g.S7a(b))}catch(d){throw a=d instanceof Error?new M5("KEY_CREATION_FAILED",{WK:d.message}):new M5("KEY_CREATION_FAILED"),g.hz(a),a;}a[1]=c}}},Gib=class extends g.jb{constructor(a,b){super();this.token=a;this.j=b;this.observers=[];a=new g.la.BroadcastChannel(`${"PERSISTENT_ENTITY_STORE_SYNC"}:${g.Mv()}`);
a.onmessage=this.A.bind(this);this.channel=a}A(a){Bib(this,a.data)}Aa(){this.channel.close()}},b6;var vjb=new g.C_("elementsCommand");var D6=new g.C_("entityBatchUpdate");var mjb=new g.C_("downloadStatusEntity");var Wkb=new g.C_("mainPlaylistEntityActionMetadata");var $6=new g.C_("mainVideoEntityActionMetadata");var vlb=new g.C_("musicPlaylistEntityActionMetadata");var Alb=new g.C_("musicTrackEntityActionMetadata");var wjb=new g.C_("offlineOrchestrationActionCommand");var ilb=new g.C_("localImageEntityActionMetadata");var I6=new g.C_("playbackDataActionMetadata");var Ljb=new g.C_("transferEntityActionMetadata");g.eI("","downloadsPageViewConfigurationEntity");g.eI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");var E6=g.eI("DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS","mainDownloadsListEntity");g.eI("SMART_DOWNLOADS_ENABLED","settingEntity");g.eI("SMART_DOWNLOADS_OPT_IN_BANNER_DISMISSED","settingEntity");var Wib=class{constructor(){this.j=new Map}},d6;new g.YZ;new g.YZ;var ajb=class{constructor(){this.locks=navigator.locks}request(a,b={},c){return this.locks.request(a,b,d=>c(d))}};var g6=g.la.caches,f6,h6,Tlb=class{open(a){return g6.open(e6(a))}has(a){return g6.has(e6(a))}delete(a){return g6.delete(e6(a))}async match(a,b){var c=await this.keys();for(const d of c)if(c=await (await this.open(d)).match(a,b))return c}},djb=class extends Tlb{async keys(){const a=[],b=g.Mv("CacheStorage keys");var c=await g6.keys();for(const d of c){c=d.indexOf(":");const {nF:e,datasyncId:f}=-1===c?{nF:d}:{nF:d.substring(0,c),datasyncId:d.substring(c+1)};f===b&&a.push(e)}return a}};var Ulb=class extends g.jb{constructor(a){super();this.api=a;this.Sd={c3a:()=>this.j,
u3a:()=>this.A};
"undefined"!==typeof g.la.BroadcastChannel&&(this.j=new g.la.BroadcastChannel(`${"PLAYER_OFFLINE_ERROR_SYNC"}:${g.Mv()}`),this.j.onmessage=this.B.bind(this),this.A=new g.la.BroadcastChannel(`${"PLAYER_OFFLINE_PAUSE_SYNC"}:${g.Mv()}`),this.A.onmessage=this.C.bind(this))}B(a){this.api.Ua("onOfflineOperationFailure",a.data)}C(a){this.api.qa("offlinetransferpause",a.data)}Aa(){let a;null==(a=this.j)||a.close();let b;null==(b=this.A)||b.close()}};var Vlb=class{constructor(a,b,c,d){this.O=a;this.ma=b;this.visibility=c;this.N=d;this.D=this.K=this.J=this.B=this.j=!1;this.C=new g.as(()=>{this.NF()});
this.Sd={pP:()=>this.A,
NF:()=>{this.NF()},
A3a:()=>this.C};
this.visibility.subscribe("visibilitystatechange",()=>{this.pg()})}pg(){this.j&&l6(this)}NF(){this.A&&this.A.resolve();
this.B=this.j=!1;this.ma()}};var akb=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var v6=class{constructor(a,b,c,d,e=b,f,h,k,l,m,n){this.entityType=a;this.actionId=b;this.action=c;this.parentActionId=d;this.rootActionId=e;this.childActionIds=f;this.prereqActionId=h;this.postreqActionIds=k;this.hasChildActionFailed=m;this.retryScheduleIndex=0;this.j=n||Date.now();this.retryScheduleIndex=l||0}};var tjb="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");var i7=class{constructor(a){this.j=a}},K6=class{constructor(a,b,c,d,e){this.status=a;this.j=b;this.C=c;this.A=d;this.B=e}};var Wlb=class extends i7{constructor(a,b,c){super(a);this.j=a;this.Y=b;this.C=c;this.B=this.Y.N("html5_oduc_transfer_logging")}A(a){return o6(a)?Ejb(this,a):p6(a)?Fjb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var Xlb=class extends i7{constructor(a,b){super(a);this.j=a;this.Y=b}A(a){return o6(a)?Ijb(this,a):p6(a)?Jjb(this,a):"OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"===a.actionType&&a.entityKey?Kjb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var Ylb=class{constructor(){this.actions=[]}j(a,b){let c=a.action.actionMetadata.priority-b.action.actionMetadata.priority;0===c&&(a.j<b.j?c=-1:a.j>b.j&&(c=1));return c}};var Rjb=class extends g.jb{constructor(a,b,c,d){super();this.A=a;this.oa=b;this.Z=c;this.K=d;this.j=new Ylb;this.J=new g.b0;this.B=new g.as(()=>{this.retry()});
this.O=NaN;this.D=!1;this.Sd={y3a:()=>this.j,
tP:()=>this.J,
E3a:()=>this.B,
retry:()=>this.retry()};
g.B(this,this.B);this.ma=Y5(this.A,this.ea.bind(this))}Aa(){this.ma&&this.ma();super.Aa()}createAction(a,b){const c=g.dI(a.entityKey).entityType,d=g.Px(16);return new v6(c,d,a,b.actionId,b.rootActionId)}async ea(a){if(!this.isDisposed()){var b;a=null!=(b=a.offlineOrchestrationActionWrapperEntity)?b:new Set;b=[];for(var c of a)({entityId:a}=g.dI(c)),Qjb(this.j,a)||b.push(c);c=await Zjb(this,b);await N6(this,c)}}async retry(){await ckb(this)}};var Zlb=class{constructor(){this.j=void 0}};var $lb=class{constructor(a,b){this.api=a;this.j=b;this.logger=new g.e2("woffle");this.A=!1;this.Sd={MI:this.MI}}async C(a){if(g.T(a.state,128)){const b=a.state.nh;a=null==b?void 0:b.errorCode;a="net.connect"===a&&1===(null==b?void 0:b.GD)?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(null==a?0:a.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";await this.Ju(this.player.getVideoData().videoId,a)}}async Ju(a,b){this.A||(this.A=!0,"TRANSFER_FAILURE_REASON_NETWORK_LOST"===
b?P6(this,a,!1,!0):(await O6(this,a),g.gO(a,4),await this.j.Ju(b)))}eF(a){2===a.status?(a.status!==this.B&&(V6(this.j),g.gO(a.videoId,2)),a.GF&&qkb(this.j,a.videoId,a.GF)):4===a.status?(O6(this,a.videoId),this.Ju(a.videoId,a.oJ?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):1===a.status&&skb(this.j);this.B=a.status;this.api.Ua("localmediachange",{videoId:a.videoId,status:a.status})}async DK(){if(!this.A){this.A=!0;var a=this.player.getVideoData().videoId;await O6(this,
a);await this.j.DK()}}MI(a){switch(a){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}}N(a){return this.api.V().N(a)}};var amb=class extends g.jb{constructor(a){super();this.j=a;this.A=Y5(this.j,this.B.bind(this))}Aa(){this.A&&this.A();super.Aa()}async B(a){var b;a=null!=(b=a.transfer)?b:new Set;b=[];for(const c of a)({entityId:a}=g.dI(c)),b.push(a);0!==b.length&&await lkb(this,b)}};var Ekb=class extends g.jb{constructor(a,b,c,d){super();this.A=a;this.api=b;this.Ka=c;this.ea=d;this.J=new g.b0;this.C=new g.as(()=>{this.j&&"TRANSFER_STATE_TRANSFERRING"===this.j.transferState&&this.J.Kh()&&(3>(this.j.transferRetryCount||0)?P6(this.K,this.D,!1,!1):O6(this.K,this.D.videoDetails.videoId),this.Ju("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Z=this.Ba=0;this.Qa=g.LG(this.api.V().experiments,"html5_transfer_processing_logs_interval");this.O=!1;this.Fa=new g.J0(this);this.ma=!1;this.Sd={G3a:()=>this.C,
r3a:()=>this.ea,
tP:()=>this.J};
this.oa=Y5(this.A,this.Oa.bind(this));this.K=new $lb(b,this);this.Ya=new Zlb;this.va=new amb(this.A);this.Ga=this.J.Ta("publicytnetworkstatus-online",this.lC.bind(this));this.Ca=this.J.Ta("publicytnetworkstatus-offline",this.Wa.bind(this));this.ma=this.api.V().N("html5_less_transfer_processing_logs");g.B(this,this.Fa);this.Fa.T(b,"offlinetransferpause",this.eb);g.qK(this.api.V())?this.B="mainVideoDownloadStateEntity":g.GA(this.api.V())&&(this.B="musicTrackDownloadMetadataEntity")}Aa(){this.oa&&this.oa();
this.va.dispose();this.C.dispose();this.Ga&&g.ie(this.J.Hl,this.Ga);this.Ca&&g.ie(this.J.Hl,this.Ca);super.Aa()}async eb(a){const b=g.eI(a,"transfer");if(this.j&&b===this.j.key)P6(this.K,this.D,!0),this.C.stop();else{const c=await X5(this.A,{mode:"readwrite",jc:!0},d=>Q5(d,b,"transfer").then(e=>{if(e&&"TRANSFER_STATE_COMPLETE"!==e.transferState&&"TRANSFER_STATE_FAILED"!==e.transferState)return e.transferState="TRANSFER_STATE_PAUSED_BY_USER",U5(d,e,"transfer").then(()=>e)}));
if(c){a&&this.B&&await r6(a,this.B,this.A,"DOWNLOAD_STATE_PAUSED");const d=await R6(this,a);kjb({videoId:a,ll:c,offlineModeType:d})}}}Wa(){if(this.j&&this.D){P6(this.K,this.D,!1);const a=this.j,b=(null==a?0:a.key)?g.dI(a.key).entityId:"";b&&this.B&&(new Promise((c,d)=>{r6(b,this.B,this.A,"DOWNLOAD_STATE_PAUSED").catch(e=>{d(e)})})).catch(c=>{j6("Download state setting error",c)})}this.C.stop()}lC(){this.j?zkb(this,this.j):U6(this)}async Oa(a){if(this.j&&("TRANSFER_STATE_COMPLETE"!==this.j.transferState&&
"TRANSFER_STATE_FAILED"!==this.j.transferState&&a.transfer&&a.transfer.has(this.j.key)&&((this.j=await $5(this.A,this.j.key,"transfer"))||await Akb(this)),this.j))return;
await U6(this)}async Ju(a,b){if(this.j){var c=this.j;const e=(null==c?0:c.key)?g.dI(c.key).entityId:"";a:switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var d=!1;break a;default:d=!0}d&&Bkb(this)?(await Q6(this,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),a=await R6(this,e),m6({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:e,
ll:c,offlineModeType:a}),e&&this.B&&await r6(e,this.B,this.A,"DOWNLOAD_STATE_RETRYABLE_FAILURE")):(await Ckb(this,a),e&&this.B&&await r6(e,this.B,this.A,"DOWNLOAD_STATE_FAILED"))}else S6(this,`onTransferFailure: ${a}`);T6(this);c=U6(this,!0);b&&b(c)}async DK(a){if(this.j)if(Bkb(this)){await Q6(this,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH");this.j||S6(this,"onMaybeTransferStreamsExpiredRetryAttempting");var b=this.j,c=(null==b?0:b.key)?g.dI(b.key).entityId:"",d=await R6(this,c);m6({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},
{videoId:c,ll:b,offlineModeType:d});b=ojb();g.tz(b,I6,{isEnqueuedForExpiredStreamUrlRefetch:!0});d=g.eI(c,"playbackData");c=x6(new v6("playbackData",c,{actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:d,actionMetadata:b}));await Z5(this.A,c,"offlineOrchestrationActionWrapperEntity")}else await Ckb(this,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),this.B&&(c=this.j,(c=(null==c?0:c.key)?g.dI(c.key).entityId:"")&&await r6(c,this.B,this.A,"DOWNLOAD_STATE_FAILED"));else S6(this,"onMaybeTransferStreamsExpired");
T6(this);c=U6(this,!0);a&&a(c)}},W6={TRANSFER_STATE_TRANSFERRING:1,TRANSFER_STATE_TRANSFER_IN_QUEUE:2};var bmb=class{constructor(a,b){this.Y=a;this.api=b;this.K=new g.b0;this.B=new Vlb(()=>Dkb(this),()=>{this.aM()},this.api.xo(),this.api.N.bind(this.api));
this.j=new Ulb(this.api);this.C=new g.YZ;this.Sd={pP:()=>this.B.Sd.pP(),
tP:()=>this.K,
s3a:()=>this.B,
BJ:()=>this.BJ(),
WL:()=>this.WL(),
aM:()=>this.aM(),
nC:()=>this.nC()};
fjb(this.B)}BJ(){return this.C.promise}WL(){if(this.A&&this.J)return this.C.promise;Gkb(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise}D(a){return{playbackData:new Wlb(a,this.Y,this.j),transfer:new Xlb(a,this.Y)}}async nC(){this.A&&await tkb(this.A)}async aM(){if(this.A||this.J){await this.BJ();void 0!==this.ma&&(g.ou(this.ma),this.ma=void 0);var a;null==(a=this.A)||a.dispose();this.A=void 0;var b;null==(b=this.J)||b.dispose();this.J=void 0;this.api.Ua("onOrchestrationLostLeader");
this.C=new g.YZ}}isOrchestrationLeader(){return this.B.j}async ea(){return!1}bL(a){var b=this.j;b.api.qa("offlinetransferpause",a);let c;null==(c=b.A)||c.postMessage(a)}async lC(a){const b=await c6();if(b){var c=g.eI(a,"transfer");await X5(b,{mode:"readwrite",jc:!0},d=>{const e=Q5(d,c,"transfer");let f=void 0;this.Y.N("html5_oduc_transfer_logging")&&(f=Q5(d,g.eI(a,"videoDownloadContextEntity"),"videoDownloadContextEntity"));return g.kw.all([e,f]).then(([h,k])=>h&&"TRANSFER_STATE_PAUSED_BY_USER"===
h.transferState?(h.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",U5(d,h,"transfer").then(()=>{m6({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",statusType:"USER_RESUMED"},{videoId:a,ll:h,offlineModeType:null==k?void 0:k.offlineModeType});return g.kw.resolve(null)})):g.kw.resolve(null))})}}async Z(a=43200){if(!this.K.Kh())return Hkb();
var b=await c6();if(!b)return[];const c=Date.now()/1E3;var d=await a6(b,"offlineVideoPolicy");b=[];for(const e of d)Number(e.lastUpdatedTimestampSeconds)+a<=c&&(d=g.dI(e.key).entityId,b.push(d));return b.length?X6(this,b,this.oa,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"):[]}async refreshAllStaleEntities(a){return await this.Z(a)}async O(){return[]}};var cmb=class extends i7{constructor(a,b,c){super(a);this.j=a;this.Y=b;this.C=c;this.B=this.Y.N("html5_oduc_transfer_logging")}A(a){return o6(a)?Vkb(this,a):p6(a)?Xkb(this,a):q6(a)?Ykb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},Y6=[10];var dmb=class extends i7{constructor(a,b,c){super(a);this.j=a;this.Y=b;this.C=c;this.B=this.Y.N("html5_oduc_transfer_logging")}A(a){return o6(a)?elb(this,a):p6(a)?flb(this,a):q6(a)?glb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},dlb=[10];var emb=class extends i7{constructor(a,b,c){super(a);this.j=a;this.Y=b;this.C=c;this.B=this.Y.N("html5_oduc_transfer_logging")}A(a){return p6(a)?jlb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}};var fmb=class extends bmb{constructor(){super(...arguments);this.oa="mainVideoEntity"}D(a){const b=super.D(a);b.mainVideoEntity=new dmb(a,this.Y,this.j);b.mainPlaylistEntity=new cmb(a,this.Y,this.j);b.mainDownloadsListEntity=new emb(a,this.Y,this.j);return b}async refreshAllStaleEntities(a,b){let c=[];this.Y.N("web_player_offline_playlist_auto_refresh")&&(c=await klb(this,a,b));var d=await a7.getInstance();const e=await (null==d?void 0:d.get("sdois"));d=await (null==d?void 0:d.get("lmqf"));e&&(c=
c.concat(await llb(this,e,null!=d?d:"SD",0===a)));return c=c.concat(await super.refreshAllStaleEntities(a,b))}async nC(){await super.nC();this.Y.N("woffle_enable_main_downloads_library")&&await mlb()}async ea(a){var b=await c6();if(!b)return!1;b=await $5(b,E6,"mainDownloadsListEntity");let c;if(null==b?0:null==(c=b.downloads)?0:c.length){a=g.eI(a,"mainVideoEntity");for(const d of b.downloads)if(d.videoItem===a)return!0}return!1}async O(){var a=await c6();if(!a)return[];var b=await a6(a,"downloadStatusEntity");
a=[];for(const c of b)"DOWNLOAD_STATE_USER_DELETED"===c.downloadState&&c.key&&(b=g.dI(c.key).entityId,a.push(b));return a.length?X6(this,a,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"):[]}};var plb="downloadStatusEntity musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");var gmb=class extends i7{constructor(a,b){super(a);this.j=a;this.B=b}A(a){return o6(a)?ulb(this,a):p6(a)?wlb(this,a):q6(a)?xlb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},e7=[10];var hmb=class extends i7{constructor(a,b){super(a);this.j=a;this.B=b}A(a){return o6(a)?Dlb(this,a):p6(a)?Elb(this,a):q6(a)?Flb(this,a):Promise.reject(Error(`Unsupported action type: ${a.actionType}`))}},Clb=[10];var imb=class extends bmb{constructor(){super(...arguments);this.oa="musicTrack"}D(a){const b=super.D(a);b.musicTrack=new hmb(a,this.j);b.musicPlaylist=new gmb(a,this.j);return b}async refreshAllStaleEntities(a,b){let c=[];return c=c.concat(await super.refreshAllStaleEntities(a,b))}};g.yQ("offline",class extends g.I1{constructor(){super(...arguments);this.events=new g.J0(this);this.Y=this.player.V();this.Sd={t3a:()=>this.j,
gE:()=>this.gE()}}create(){g.B(this,this.events);
g.qK(this.Y)?this.j=new fmb(this.Y,this.player):g.GA(this.Y)&&(this.j=new imb(this.Y,this.player));this.events.T(this.player,"onPlaybackStartExternal",()=>{this.gE()});
this.events.T(this.player,"videodatachange",()=>{this.gE()})}bl(){return!1}async zY(a,b,c,d){return this.j?X6(this.j,a,b,c,d):Promise.reject()}Z(a){return this.j.Z(a)}refreshAllStaleEntities(a){return this.j.refreshAllStaleEntities(a)}bL(a){this.j.bL(a)}lC(a){return this.j.lC(a)}async gE(){const a=this.player.getVideoData();
g.iP(a)&&Hlb(a)&&this.A!==a.clientPlaybackNonce&&await Ilb(this,a)}isOrchestrationLeader(){return this.j.isOrchestrationLeader()}async updateDownloadState(a,b){const c=await c6();if(c){var {entityType:d,entityId:e}=g.dI(a);await r6(e,d,c,b,!0)}else j6("PES is undefined")}});})(_yt_player);
